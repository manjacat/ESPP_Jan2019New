@model eSPP.Models.HR_MAKLUMAT_KEWANGAN8
<div>
    <div class="modal-header">
        <button type="button" class="close" aria-hidden="true">
            &times;
        </button>
        <h4 class="modal-title">
            Info  <span class="error"></span>
        </h4>
    </div>
    <div class="modal-body no-padding">

        @using (Html.BeginForm("InfoKew8", "Kewangan8", FormMethod.Post, new { @class = "smart-form", id = "form" }))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            @Html.HiddenFor(model => model.HR_NO_PEKERJA)
            @Html.HiddenFor(model => model.HR_KOD_PERUBAHAN)
            @Html.HiddenFor(model => model.HR_TARIKH_MULA)
            @Html.HiddenFor(model => model.HR_TARIKH_KEYIN)
            @Html.HiddenFor(model => model.HR_KEW8_ID)
            @Html.HiddenFor(model => model.HR_ANSURAN_ID)
            @Html.HiddenFor(model => model.HR_NP_FINALISED_HR)
            @Html.Hidden("HR_KOD_JAWATAN", null)
            @Html.Hidden("PA_BULAN", Model.HR_BULAN)
            @Html.Hidden("PA_TAHUN", Model.HR_TAHUN)
            @Html.Hidden("Kod", (string)ViewBag.Kod)
            @*@Html.HiddenFor(model => model.HR_FINALISED_IND_HR)*@
        List<HR_MAKLUMAT_PERIBADI> sPegawai = (List<HR_MAKLUMAT_PERIBADI>)ViewBag.sPegawai;
        <fieldset>
            <div class="row">
                @if (ViewBag.Kod == "00036" || ViewBag.Kod == "TMK" || ViewBag.Kod == "00032" || ViewBag.Kod == "00004")
                {
                    if (ViewBag.Kod == "00036")
                    {
                        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="row">
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4">Jawatan</label>
                                        <div class="col col-8">
                                            <label class="select">
                                                @Html.DropDownList("HR_KOD_JAWATAN", new SelectList(ViewBag.SENARAI_JAWATAN, "Value", "Text", ViewBag.HR_KOD_JAWATAN), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                                <i></i>
                                            </label>
                                        </div>
                                    </div>
                                </section>
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4">Kod Gaji Berkomputer</label>
                                        <div class="col col-4">
                                            <label class="input">
                                                @Html.TextBox("HR_KOD_GAJI", (string)ViewBag.kodGaji, new { @class = "form-control", disabled = "disabled" })
                                            </label>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>

                        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="row">
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4">Kategori Perubahan</label>
                                        <div class="col col-8">

                                            <label class="select">
                                                @Html.HiddenFor(model => model.HR_KOD_PERUBAHAN)
                                                @Html.DropDownListFor(model => model.HR_KOD_PERUBAHAN, new SelectList(ViewBag.HR_KOD_PERUBAHAN, "Value", "Text"), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                                <i></i>
                                            </label>

                                        </div>
                                    </div>
                                </section>

                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4" id="txtTarikhMula">Tarikh Mula</label>
                                        <div class="col col-4">
                                            <label class="input">
                                                <i class="icon-append fa fa-calendar"></i>
                                                <input type="text" name="HR_TARIKH_MULA" id="HR_TARIKH_MULA" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}", Model.HR_TARIKH_MULA)" />
                                            </label>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    }
                    if (ViewBag.Kod == "TMK" || ViewBag.Kod == "00032" || ViewBag.Kod == "00004")
                    {
                        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="row">
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4">Kategori Perubahan</label>
                                        <div class="col col-8">

                                            <label class="select">
                                                @Html.DropDownListFor(model => model.HR_KOD_PERUBAHAN, new SelectList(ViewBag.HR_KOD_PERUBAHAN, "Value", "Text"), htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                                <i></i>
                                            </label>

                                        </div>
                                    </div>
                                </section>

                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4">Kod Gaji Berkomputer</label>
                                        <div class="col col-4">
                                            <label class="input">
                                                @Html.TextBox("HR_KOD_GAJI", (string)ViewBag.kodGaji, new { @class = "form-control", disabled = "disabled" })
                                            </label>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>

                        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="row">
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4" id="txtTarikhMula">Tarikh Mula</label>
                                        <div class="col col-4">
                                            <label class="input">
                                                <i class="icon-append fa fa-calendar"></i>
                                                <input type="text" name="HR_TARIKH_MULA" id="HR_TARIKH_MULA" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}", Model.HR_TARIKH_MULA)" />
                                            </label>
                                        </div>
                                    </div>
                                </section>
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4" id="txtTarikhMula">Tarikh Tamat</label>
                                        <div class="col col-4">
                                            <label class="input">
                                                <i class="icon-append fa fa-calendar"></i>
                                                <input type="text" name="HR_TARIKH_AKHIR" id="HR_TARIKH_AKHIR" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}", Model.HR_TARIKH_AKHIR)" />
                                            </label>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>

                        @*<div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div class="row">
                                    <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                        <div class="row">
                                            <label class="label col col-4" id="txtTarikhMula">Tarikh Semasa</label>
                                            <div class="col col-4">
                                                <label class="input">
                                                    <i class="icon-append fa fa-calendar"></i>
                                                    <input type="text" name="HR_TARIKH_KEYIN" id="HR_TARIKH_KEYIN" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}", Model.HR_TARIKH_KEYIN)" />
                                                </label>
                                            </div>
                                        </div>
                                    </section>
                                    <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                        <div class="row">
                                            <label class="label col col-4">Nama Pekerja (Tanggung/Pangku)</label>
                                            <div class="col col-8">
                                                <label class="input">
                                                    @Html.TextBox("HR_NAMA_PEKERJA_PT", null, new { @class = "form-control", list = "list-pt", disabled = "disabled" })
                                                    <datalist id="list-pt">
                                                        @foreach (var pegawai in sPegawai)
                                                        {
                                                            <option value="@(pegawai.HR_NAMA_PEKERJA)" data-value="@pegawai.HR_NO_PEKERJA">@(pegawai.HR_NO_PEKERJA)</option>
                                                        }
                                                    </datalist>
                                                    @Html.Hidden("HR_NO_PEKERJA_PT", null, new { @class = "form-control" })
                                                </label>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>*@
                    }
                    <div class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        @if (ViewBag.Kod == "TMK" || ViewBag.Kod == "00032" || ViewBag.Kod == "00004")
                        {
                            <section>
                                <div class="row">
                                    <label class="label col col-4">Jawatan (Lama)</label>
                                    <div class="col col-8">
                                        <label class="select">
                                            @Html.DropDownList("HR_KOD_JAWATAN", new SelectList(ViewBag.SENARAI_JAWATAN, "Value", "Text", ViewBag.HR_KOD_JAWATAN), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4">Gred (Lama)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.TextBox("HR_GRED_LAMA", (string)ViewBag.HR_GRED_LAMA, new { @class = "form-control", disabled = "disabled" })
                                    </label>
                                </div>
                            </div>
                        </section>
                        @if (ViewBag.Kod == "00036")
                        {
                            <section>
                                <div class="row">
                                    <label class="label col col-4">Gaji Min (Lama)</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_GAJI_MIN_LAMA", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_MIN_LAMA), new { @class = "form-control", disabled = "disabled" })
                                        </label>
                                    </div>

                                    <label class="label col col-2">Max</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_GAJI_MAX_LAMA", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_MAX_LAMA), new { @class = "form-control", disabled = "disabled" })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4">Gaji Pokok (Lama)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.TextBox("HR_GAJI_LAMA", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_LAMA), new { @class = "form-control", disabled = "disabled" })
                                    </label>
                                </div>
                                @if (ViewBag.Kod == "TMK")
                                {
                                    @Html.Hidden("HR_PGT_LAMA", string.Format("{0:0.00}", (decimal?)ViewBag.HR_PGT_LAMA), new { @class = "form-control", disabled = "disabled" })
                                }
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Matriks Gaji (Lama)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.TextBox("HR_MATRIKS_GAJI_LAMA", null, new { @class = "form-control", disabled = "disabled" })
                                    </label>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        @if (ViewBag.Kod == "00032")
                        {
                            @Html.Hidden("HR_NO_PEKERJA_PT", null)
                            <section>
                                <div class="row">
                                    <label class="label col col-4">Nama Tanggung</label>
                                    <div class="col col-8">
                                        <label class="input">
                                            <i class="icon-append fa fa-search"></i>
                                            @Html.TextBox("HR_NAMA_PT", null, new { @class = "form-control", @readonly = "readonly", disabled = "disabled" })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }
                        @if (ViewBag.Kod == "TMK" || ViewBag.Kod == "00032" || ViewBag.Kod == "00004")
                        {
                            <section>
                                <div class="row">
                                    <label class="label col col-4">Jawatan (Baru)</label>
                                    <div class="col col-8">
                                        <label class="select">
                                            @Html.DropDownList("HR_JAWATAN_BARU", new SelectList(ViewBag.SENARAI_JAWATAN, "Value", "Text", ViewBag.HR_JAWATAN_BARU), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4">Gred (Baru)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.TextBox("HR_GRED", null, new { @class = "form-control", autocomplete = "off", list = "list-gred", disabled = "disabled" })
                                        <datalist id="list-gred">
                                            @foreach (GE_PARAMTABLE gred in ViewBag.gredList)
                                            {
                                                <option value="@gred.SHORT_DESCRIPTION" data-value="@gred.ORDINAL">@gred.ORDINAL</option>
                                            }
                                        </datalist>
                                    </label>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Gaji Min (Baru)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.TextBox("HR_GAJI_MIN_BARU", (ViewBag.Kod == "00036") ? string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_MIN_BARU) : string.Format("{0:0.00}", Model.HR_GAJI_MIN_BARU), new { @class = "form-control", list = "list-min", autocomplete = "off", disabled = "disabled" })
                                        <datalist id="list-min"></datalist>
                                    </label>
                                </div>
                                @if (ViewBag.Kod != "00032" && ViewBag.Kod != "00004")
                                {
                                    <label class="label col col-2">Max</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_GAJI_MAX_BARU", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_MAX_BARU), new { @class = "form-control", list = "list-max", autocomplete = "off", disabled = "disabled" })
                                            <datalist id="list-max"></datalist>
                                        </label>
                                    </div>
                                }
                            </div>
                        </section>
                        @if (ViewBag.Kod != "00032" && ViewBag.Kod != "00004")
                        {
                            <section>
                                <div class="row">
                                    @if (ViewBag.Kod != "00032" && ViewBag.Kod != "00004")
                                    {
                                        <label class="label col col-4">Gaji Pokok (Baru)</label>
                                        <div class="col col-3">
                                            <label class="input">
                                                @Html.TextBox("HR_GAJI_BARU", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_BARU), new { @class = "form-control", list = "list-gaji", autocomplete = "off", disabled = "disabled" })
                                                <datalist id="list-gaji"></datalist>
                                            </label>
                                        </div>
                                    }
                                    @if (ViewBag.Kod == "TMK")
                                    {
                                        <label class="label col col-2">PGT</label>
                                        <div class="col col-3">
                                            <label class="input">
                                                @Html.TextBox("HR_PGT_BARU", string.Format("{0:0.00}", (decimal?)ViewBag.HR_PGT_BARU), new { @class = "form-control", disabled = "disabled" })
                                            </label>
                                        </div>
                                    }
                                </div>
                            </section>

                            <section>
                                <div class="row">
                                    <label class="label col col-4">Matriks Gaji (Baru)</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_MATRIKS_GAJI", null, new { @class = "form-control", disabled = "disabled" })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }
                        else
                        {
                            @Html.Hidden("HR_GAJI_BARU", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_BARU))
                            @*@Html.Hidden("HR_PGT_BARU", string.Format("{0:0.00}", (decimal?)ViewBag.HR_PGT_BARU))*@
                            @Html.Hidden("HR_MATRIKS_GAJI", null)
                        }
                    </div>

                    <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="row">
                            @{ var changeJumTxt = "Jumlah Tunggakan";}
                            @if (ViewBag.Kod == "TMK" || ViewBag.Kod == "00032" || ViewBag.Kod == "00004")
                            {
                                changeJumTxt = "Jumlah Tunggakan";
                                //if (Model.HR_TARIKH_MULA > Model.HR_TARIKH_KEYIN)
                                //{
                                //    changeJumTxt = "Jumlah Potongan";
                                //    //KOD_PELARASAN_GAJI = ViewBag.kodPGaji;
                                //}
                                //else
                                //{
                                //    changeJumTxt = "Jumlah Tunggakan";
                                //    //KOD_PELARASAN_GAJI = ViewBag.kodTGaji;
                                //}
                                <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                    <div class="row">
                                        <label class="label col col-4">Jumlah Elaun</label>
                                        <div class="col col-3">
                                            <label class="input">
                                                @Html.TextBox("HR_JUMLAH_PERUBAHAN_ELAUN", string.Format("{0:0.00}", (decimal?)ViewBag.HR_JUMLAH_PERUBAHAN_ELAUN), new { @class = "form-control", disabled = "disabled", id = "HR_JUMLAH_PERUBAHAN_ELAUN" })
                                            </label>
                                        </div>
                                    </div>
                                </section>
                            }
                            <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                <div class="row">
                                    <label class="label col col-4" id="changeJumTxt">@changeJumTxt</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.Hidden("[0].HR_KOD_CARUMAN", (string)ViewBag.kodG, new { @class = "form-control", id = "HR_KOD_ELAUN" })
                                            @Html.TextBox("[0].HR_NILAI", string.Format("{0:0.00}", (decimal?)ViewBag.HR_JUMLAH_PERUBAHAN), new { @class = "form-control", disabled = "disabled", id = "HR_JUMLAH_PERUBAHAN" })
                                            @Html.Hidden("[0].HR_KOD_POTONGAN", (ViewBag.Kod == "00036") ? (string)ViewBag.kodTGaji : (string)ViewBag.HR_KOD_PELARASAN, new { @class = "form-control", id = "HR_KOD_POTONGAN" })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                }
                else
                {
                    <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="row">
                            <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                <div class="row">
                                    <label class="label col col-4">Jawatan</label>
                                    <div class="col col-8">
                                        <label class="select">
                                            @Html.DropDownList("HR_KOD_JAWATAN", new SelectList(ViewBag.SENARAI_JAWATAN, "Value", "Text", ViewBag.HR_KOD_JAWATAN), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    </div>
                                </div>
                            </section>

                            <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                <div class="row">
                                    <label class="label col col-4">Gred</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_GRED_LAMA", (string)ViewBag.HR_GRED_LAMA, new { @class = "form-control", disabled = "disabled" })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div class="row">
                            <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                <div class="row">
                                    <label class="label col col-4">Gaji Pokok</label>
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_GAJI_LAMA", string.Format("{0:0.00}", (decimal?)ViewBag.HR_GAJI_LAMA), new { @class = "form-control", disabled = "disabled" })
                                        </label>
                                    </div>
                                </div>
                            </section>

                            <section class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                <div class="row">
                                    <label class="label col col-4">Kod Gaji Berkomputer</label>
                                    <div class="col col-4">
                                        <label class="input">
                                            @Html.TextBox("HR_KOD_GAJI", (string)ViewBag.kodGaji, new { @class = "form-control", disabled = "disabled" })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                }

                <div class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    @if (ViewBag.Kod != "00036" && ViewBag.Kod != "CUTI" && ViewBag.Kod != "LNTKN" && ViewBag.Kod != "TMK" && ViewBag.Kod != "00032" && ViewBag.Kod != "00004")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">Kategori Perubahan</label>
                                <div class="col col-8">
                                    @if (ViewBag.Kod == "kew8")
                                    {
                                        <label class="select">
                                            @Html.DropDownListFor(model => model.HR_KOD_PERUBAHAN, new SelectList(ViewBag.HR_KOD_PERUBAHAN, "Value", "Text"), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    }
                                    else if (ViewBag.Kod == "TP")
                                    {
                                        <label class="input">
                                            @Html.TextBox("HR_PENERANGAN", null, new { @class = "form-control", id = "HR_PENERANGAN", disabled = "disabled" })
                                        </label>
                                    }
                                    else
                                    {
                                        <label class="select">
                                            @*@Html.HiddenFor(model => model.HR_KOD_PERUBAHAN)*@
                                            @Html.DropDownListFor(model => model.HR_KOD_PERUBAHAN, new SelectList(ViewBag.HR_KOD_PERUBAHAN, "Value", "Text"), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    }

                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00031" || ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00039" || ViewBag.Kod == "00024" || ViewBag.Kod == "LNTKN")
                    {
                        var jPelarasan = "Jenis Perubahan";
                        if (ViewBag.Kod == "00039" || ViewBag.Kod == "00024")
                        {
                            if (ViewBag.Kod == "00024")
                            {
                                jPelarasan = "Jenis Elaun";
                            }
                            else
                            {
                                jPelarasan = "Jenis Potongan";
                            }
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4">@jPelarasan</label>
                                <div class="col col-8">
                                    @if (ViewBag.Kod == "00039" || ViewBag.Kod == "00024")
                                    {
                                        <label class="select">
                                            @Html.Hidden("HR_KOD_PELARASAN", (string)ViewBag.kodPelarasan)
                                            @Html.DropDownList("HR_KOD_PELARASAN", null, String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })<i></i>
                                        </label>
                                    }
                                    @if (ViewBag.Kod == "00031")
                                    {
                                        <label class="select">
                                            @Html.DropDownList("HR_KOD_PELARASAN", null, String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })<i></i>
                                        </label>
                                    }
                                    @if (ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "LNTKN")
                                    {
                                        <label class="select">
                                            @Html.DropDownListFor(model => model.HR_KOD_PERUBAHAN, new SelectList(ViewBag.HR_KOD_PERUBAHAN, "Value", "Text"), String.Empty, htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    }
                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00031")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">Jumlah Bulan</label>
                                <div class="col col-8">
                                    <label class="input">
                                        @Html.TextBox("HR_JUMLAH_BULAN", null, new { @class = "form-control", id = "HR_JUMLAH_BULAN", disabled = "disabled" })
                                    </label>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Nilai KWSP</label>
                                <div class="col col-8">
                                    <label class="input">
                                        @Html.TextBox("HR_NILAI_EPF", null, new { @class = "form-control", id = "HR_NILAI_EPF", disabled = "disabled" })
                                    </label>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Peratus KWSP</label>
                                <div class="col col-8">
                                    <label class="input">
                                        <i class="icon-append">%</i>
                                        @Html.Editor("HR_NILAI_PERATUS", null, new { htmlAttributes = new { @class = "form-control", id = "HR_NILAI_PERATUS", disabled = "disabled" } })
                                        @Html.Hidden("HR_KOD_PERATUS", null)
                                    </label>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Jumlah Perubahan</label>
                                <div class="col col-8">
                                    <label class="input">
                                        @Html.Hidden("[0].HR_KOD_CARUMAN", (string)ViewBag.kodG, new { @class = "form-control", id = "HR_KOD_ELAUN" })
                                        @Html.TextBox("[0].HR_NILAI", string.Format("{0:0.00}", (decimal?)ViewBag.HR_JUMLAH_PERUBAHAN), new { @class = "form-control", disabled = "disabled", id = "HR_JUMLAH_PERUBAHAN" })
                                    </label>
                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00026")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">Jenis Tindakan</label>
                                <div class="col col-8">
                                    <div class="inline-group">
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_KEW8_IND, "B", htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>Bayaran Gaji Semasa
                                        </label>
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_KEW8_IND, "T", htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>Tunggakan Gaji
                                        </label>
                                        @Html.HiddenFor(model => model.HR_KEW8_IND)
                                    </div>
                                </div>
                            </div>
                        </section>

                        @*<section>
                                <div class="row">
                                    <label class="label col col-4">Tarikh Jenis Perubahan</label>
                                    <div class="col col-4">
                                        <label class="input">
                                            <i class="icon-append fa fa-calendar"></i>
                                            @Html.HiddenFor(model => model.HR_TARIKH_KEYIN)
                                            <input type="text" name="HR_TARIKH_KEYIN" id="HR_TARIKH_KEYIN" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}",Model.HR_TARIKH_KEYIN)" />
                                        </label>
                                    </div>
                                </div>
                            </section>*@
                    }
                    @if (ViewBag.Kod == "LNTKN")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">Jenis Tindakan</label>
                                <div class="col col-8">
                                    <div class="inline-group">
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_LANTIKAN_IND, "P", htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>Bayaran Gaji
                                        </label>
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_LANTIKAN_IND, "T", htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>Tunggakan Gaji
                                        </label>
                                        @Html.HiddenFor(model => model.HR_LANTIKAN_IND)
                                    </div>
                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00026" || ViewBag.Kod == "00025" || ViewBag.Kod == "kew8" || ViewBag.Kod == "00022" || ViewBag.Kod == "00037" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00039" || ViewBag.Kod == "00024" || ViewBag.Kod == "LNTKN" || ViewBag.Kod == "00015")
                    {
                        var textTarikhMula = "Tarikh Mula";
                        if (ViewBag.Kod == "00026" || ViewBag.Kod == "LNTKN")
                        {
                            textTarikhMula = "Tarikh Mula Bayar Gaji";
                        }
                        if (ViewBag.Kod == "00022")
                        {
                            textTarikhMula = "Tarikh Mula Ditangguh Pergerakan Gaji";
                        }
                        if (ViewBag.Kod == "00037")
                        {
                            textTarikhMula = "Tarikh Mula Pergerakan Gaji";
                        }
                        if (ViewBag.Kod == "CUTI")
                        {
                            textTarikhMula = "Tarikh Mula Bercuti";
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4" id="txtTarikhMula">@(textTarikhMula)</label>
                                <div class="col col-4">
                                    <label class="input">
                                        <i class="icon-append fa fa-calendar"></i>
                                        <input type="text" name="HR_TARIKH_MULA" id="HR_TARIKH_MULA" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}",Model.HR_TARIKH_MULA)" />
                                    </label>
                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00026" || ViewBag.Kod == "00025" || ViewBag.Kod == "kew8" || ViewBag.Kod == "00022" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00039" || ViewBag.Kod == "00024" || ViewBag.Kod == "LNTKN" || ViewBag.Kod == "00015")
                    {
                        var textTarikhAkhir = "Tarikh Akhir";
                        if (ViewBag.Kod == "00026")
                        {
                            textTarikhAkhir = "Tarikh Akhir Bayar Gaji";
                        }
                        if (ViewBag.Kod == "00022")
                        {
                            textTarikhAkhir = "Tarikh Akhir Ditangguh Pergerakan Gaji";
                        }
                        if (ViewBag.Kod == "CUTI")
                        {
                            textTarikhAkhir = "Tarikh Lapor Diri";
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4" id="txtTarikhAkhir">@(textTarikhAkhir)</label>
                                <div class="col col-4">
                                    <label class="input">
                                        <i class="icon-append fa fa-calendar"></i>
                                        <input type="text" name="HR_TARIKH_AKHIR" id="HR_TARIKH_AKHIR" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}",Model.HR_TARIKH_AKHIR)" />
                                    </label>
                                </div>
                            </div>
                        </section>

                        if (ViewBag.Kod == "00026")
                        {
                            <section>
                                <div class="row">
                                    <label class="label col col-4" id="txtTarikhAkhir">Tarikh Tamat Perkhidmatan</label>
                                    <div class="col col-4">
                                        <label class="input">
                                            <i class="icon-append fa fa-calendar"></i>
                                            <input type="text" name="HR_TARIKH_TAMAT" id="HR_TARIKH_TAMAT" class="form-control" value="@ViewBag.HR_TARIKH_TAMAT" disabled="disabled" />
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }
                    }
                    else if (ViewBag.Kod == "TP")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">Tarikh</label>
                                <div class="col col-4">
                                    <label class="input">
                                        <i class="icon-append fa fa-calendar"></i>
                                        <input type="text" name="HR_TARIKH_KEYIN" id="HR_TARIKH_KEYIN" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}",Model.HR_TARIKH_KEYIN)" />
                                    </label>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Tarikh Tamat Perkhidmatan</label>
                                <div class="col col-4">
                                    <label class="input">
                                        <i class="icon-append fa fa-calendar"></i>
                                        <input type="text" name="HR_TARIKH_TAMAT" id="HR_TARIKH_TAMAT" class="form-control" disabled="disabled" value="@string.Format("{0:dd/MM/yyyy}",Model.HR_TARIKH_MULA)" />
                                    </label>
                                </div>
                            </div>
                        </section>
                    }
                    @*else
                        {
                            <input type="hidden" name="HR_TARIKH_MULA" id="HR_TARIKH_MULA" class="form-control" value="@string.Format("{0:dd/MM/yyyy}",DateTime.Now)" />
                        }*@
                    <section>
                        <div class="row">
                            <label class="label col col-4">Butir-Butir Perubahan</label>
                            <div class="col col-8">
                                <label class="textarea textarea-resizable">
                                    @Html.TextAreaFor(model => model.HR_BUTIR_PERUBAHAN, new { @class = "form-control custom-scroll", rows = "6", disabled = "disabled" })
                                </label>
                            </div>
                        </div>
                    </section>

                    @if (ViewBag.Kod != "00030" && ViewBag.Kod != "00015")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">No. Surat Kebenaran</label>
                                <div class="col col-8">
                                    <label class="input">
                                        @Html.EditorFor(model => model.HR_NO_SURAT_KEBENARAN, new { htmlAttributes = new { @class = "form-control", disabled = "disabled" } })
                                    </label>
                                </div>
                            </div>
                        </section>
                    }
                    <section>
                        <div class="row">
                            <label class="label col col-4">Catatan</label>
                            <div class="col col-8">
                                <label class="textarea textarea-resizable">
                                    @Html.TextAreaFor(model => model.HR_CATATAN, new { @class = "form-control custom-scroll", rows = "6", disabled = "disabled" })
                                </label>
                            </div>
                        </div>
                    </section>

                    <section>
                        <div class="row">
                            <label class="label col col-4">Nama Pegawai Pengesahan</label>
                            <div class="col col-8">
                                <label class="input">
                                    @Html.TextBox("HR_NAMA_PEGAWAI", null, new { @class = "form-control", list = "list-pegawai", autocomplete = "off", disabled = "disabled" })
                                    <datalist id="list-pegawai">
                                        @foreach (var pegawai in sPegawai)
                                        {
                                            <option value="@(pegawai.HR_NAMA_PEKERJA)" data-value="@pegawai.HR_NO_PEKERJA"></option>
                                        }
                                    </datalist>

                                </label>
                            </div>
                        </div>
                    </section>
                    @if (ViewBag.pengesahan2 == Model.HR_NP_FINALISED_HR)
                    {
                        <div id="statusdata">
                            <section>
                                <div class="row">
                                    <label class="label col col-4">Status Data</label>
                                    <div class="col col-8">
                                        <label class="select">
                                            @Html.DropDownListFor(model => model.HR_FINALISED_IND_HR, new SelectList(ViewBag.pengesahan, "Value", "Text"), new { @class = "form-control", disabled = "disabled" })
                                            <i></i>
                                        </label>
                                    </div>
                                </div>
                            </section>
                        </div>
                    }
                    else
                    {
                        @Html.HiddenFor(model => model.HR_FINALISED_IND_HR)
                    }
                </div>
                <div class="col col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    @if (ViewBag.Kod == "00030" || ViewBag.Kod == "00015")
                    {
                        if (ViewBag.Kod != "00015")
                        {
                            <section>
                                <div class="row">
                                    <div class="col col-4">
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_KEW8_IND, "A", new { @class = "form-control", disabled = "disabled" })
                                            <i></i>Amaun
                                        </label>
                                    </div>
                                    <div class="col col-8">
                                        <label class="input">
                                            @Html.EditorFor(model => model.HR_BIL, null, new { htmlAttributes = new { @class = "form-control", disabled = "disabled", id = "HR_BIL2" } })
                                        </label>
                                    </div>
                                </div>
                            </section>
                        }

                        <section>
                            <div class="row">
                                <div class="col col-4">
                                    <label class="radio">
                                        @Html.RadioButtonFor(model => model.HR_KEW8_IND, "H", new { @class = "form-control", disabled = "disabled" })
                                        <i></i>Bil. Hari
                                    </label>
                                </div>
                                <div class="col col-8">
                                    <div class="parent">
                                        <div class="row child">
                                            <div class="col col-5">
                                                <label class="select">
                                                    @Html.DropDownList("bulan", new SelectList(ViewBag.month, "Value", "Text"), String.Empty, new { @class = "form-control", id = "bulan", disabled = "disabled" })
                                                    <i></i>
                                                </label>
                                            </div>
                                            <div class="col col-4">
                                                <label class="input">
                                                    @Html.TextBox("hari", null, new { @class = "form-control", disabled = "disabled" })
                                                </label>
                                            </div>
                                            <div class="col col-3">
                                                <a class="btn btn-default btn-xs tambah" title="tambah" disabled="disabled"><i class="fa fa-plus"></i></a>
                                                <a class="btn btn-default btn-xs padam" title="padam" disabled="disabled"><i class="fa fa-minus"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <div class="col col-4">

                                </div>
                                <div class="col col-8">
                                    <div id="tableBulan"></div>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Jumlah Hari</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.EditorFor(model => model.HR_BIL, new { htmlAttributes = new { @class = "form-control", disabled = "disabled", id = "HR_BIL3" } })
                                        @Html.HiddenFor(model => model.HR_BIL)
                                    </label>
                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00030" || ViewBag.Kod == "00026" || ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00015" || ViewBag.Kod == "LNTKN")
                    {
                        var KOD_PELARASAN_GAJI = "";
                        if ((ViewBag.Kod == "00026" && Model.HR_KEW8_IND == "T") || (ViewBag.Kod == "LNTKN" && Model.HR_LANTIKAN_IND == "T"))
                        {
                            KOD_PELARASAN_GAJI = ViewBag.kodTGaji;
                        }
                        else
                        {
                            KOD_PELARASAN_GAJI = ViewBag.kodPGaji;
                        }
                        <section>
                            <div class="row">
                                <label class="label col col-4" id="tukarTajukPotonganGaji">Jumlah Potongan Gaji</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.Hidden("[0].HR_KOD_CARUMAN", (string)ViewBag.kodG, new { @class = "form-control", id = "HR_KOD_ELAUN" })
                                        @Html.TextBox("[0].HR_NILAI", string.Format("{0:0.00}", (decimal?)ViewBag.nilaiPGaji), new { @class = "form-control", disabled = "disabled", id = "HR_JUMLAH_POTONGAN_GAJI" })
                                        @Html.Hidden("[0].HR_KOD_POTONGAN", KOD_PELARASAN_GAJI, new { @class = "form-control", id = "HR_KOD_POTONGAN" })
                                    </label>
                                </div>
                            </div>
                        </section>
                    }
                    @if (ViewBag.Kod == "00030" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00015")
                    {
                        <section>
                            <div class="row">
                                <label class="label col col-4">Jumlah Potongan</label>
                                @if (ViewBag.Kod != "CUTI" && ViewBag.Kod != "00015")
                                {
                                    <div class="col col-8">
                                        <div class="row">
                                            <div class="col col-5">
                                                <label class="input">
                                                    @Html.TextBox("HR_JUMLAH_POTONGAN", string.Format("{0:0.00}", (decimal?)ViewBag.nilaiPotongan), new { @class = "form-control", disabled = "disabled", id = "HR_JUMLAH_POTONGAN" })
                                                </label>
                                            </div>
                                            <div class="col col-4">
                                                <button type="button" class="btn btn-default btn-sm ansuran" title="ansuran" id="ansuran" disabled="disabled">Ansuran <i class="fa fa-star-half-full"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="col col-3">
                                        <label class="input">
                                            @Html.TextBox("HR_JUMLAH_POTONGAN", string.Format("{0:0.00}", (decimal?)ViewBag.nilaiPotongan), new { @class = "form-control", disabled = "disabled", id = "HR_JUMLAH_POTONGAN" })
                                        </label>
                                    </div>
                                }
                            </div>
                        </section>

                        if (ViewBag.Kod != "CUTI" && ViewBag.Kod != "00015")
                        {
                            <div id="dataAnsuran"></div>
                        }

                        if (ViewBag.Kod == "CUTI")
                        {
                            <div id="tableAnsuran"></div>
                        }
                    }

                    @if (ViewBag.Kod == "00039" || ViewBag.Kod == "00024")
                    {
                        @Html.HiddenFor(model => model.HR_KEW8_IND)
                        var tindakanTxt = "Elaun";
                        if (ViewBag.Kod == "00039")
                        {
                            tindakanTxt = "Potongan";
                        }

                        var KOD_PELARASAN_GAJI = "";

                        var sHari = Model.HR_TARIKH_MULA.ToString("dd");
                        var iHari = Convert.ToInt32(sHari);

                        if (Model.HR_KEW8_IND == "P" || (Model.HR_KEW8_IND == "E" && iHari > 1))
                        {
                            KOD_PELARASAN_GAJI = ViewBag.kodPGaji;
                        }
                        else
                        {
                            KOD_PELARASAN_GAJI = ViewBag.kodTGaji;
                        }

                        <section>
                            <div class="row">
                                <label class="label col col-4">Jenis Tindakan</label>
                                <div class="col col-8">
                                    <div class="inline-group">
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_KEW8_IND, "E", htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>@(tindakanTxt) Baru
                                        </label>
                                        <label class="radio">
                                            @Html.RadioButtonFor(model => model.HR_KEW8_IND, "P", htmlAttributes: new { @class = "form-control", disabled = "disabled" })
                                            <i></i>Pemberhentian @(tindakanTxt)
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Jumlah Perubahan (RM)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.TextBox("HR_JUMLAH_PERUBAHAN_ELAUN", null, new { @class = "form-control", disabled = "disabled" })
                                    </label>
                                </div>
                            </div>
                        </section>

                        <section>
                            <div class="row">
                                <label class="label col col-4">Jumlah <span id="jumTxt">Tunggakan</span> (RM)</label>
                                <div class="col col-3">
                                    <label class="input">
                                        @Html.Hidden("[0].HR_KOD_CARUMAN", (string)ViewBag.kodG, new { @class = "form-control", id = "HR_KOD_ELAUN" })
                                        @Html.TextBox("[0].HR_NILAI", string.Format("{0:0.00}", (decimal?)ViewBag.HR_JUMLAH_PERUBAHAN), new { @class = "form-control", id = "HR_JUMLAH_PERUBAHAN", disabled = "disabled" })
                                        @Html.Hidden("[0].HR_KOD_POTONGAN", KOD_PELARASAN_GAJI, new { @class = "form-control", id = "HR_KOD_POTONGAN" })
                                    </label>
                                </div>
                            </div>
                        </section>
                    }

                    @if (ViewBag.Kod != "00036" && ViewBag.Kod != "00039" && ViewBag.Kod != "00024" && ViewBag.Kod != "TMK" && ViewBag.Kod != "00032" && ViewBag.Kod != "00004")
                    {
                        <section>
                            <div class="row">
                                @{ var tajuk = "Maklumat Potongan Elaun";}
                                @if (ViewBag.Kod == "kew8" || ViewBag.Kod == "00022" || ViewBag.Kod == "00037" || ViewBag.Kod == "00031" || ViewBag.Kod == "00025")
                                {
                                    tajuk = "Maklumat Elaun";
                                }
                                <label class="col col-lg-6 col-md-6 col-sm-12 col-xs-12" id="tukarTajukElaun">@tajuk</label>
                            </div>
                            <div class="row">

                                <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div id="tableElaun" style="overflow-x:auto; width:100%">
                                        <table class="table table-striped table-bordered table-hover" id="tableElaun2" style="width:800px">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Elaun</th>
                                                    <th>Jumlah Elaun</th>

                                                    @{ var colspan = 3;}
                                                    @if (ViewBag.Kod == "00030" || ViewBag.Kod == "00026" || ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00015" || ViewBag.Kod == "LNTKN")
                                                    {
                                                        colspan = 5;
                                                        <th>Pelarasan</th>
                                                        <th>Jumlah Pelarasan</th>
                                                    }

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @{ var no2 = 0; var num = (List<HR_ELAUN>)ViewBag.elaun3; var potongan3 = (List<HR_POTONGAN>)ViewBag.potongan3; decimal? jum = 0;}
                                                @if (num.Count() <= 0)
                                                {
                                                    <tr>
                                                        <td colspan="@colspan" style="padding:20px" align="center">Tiada Elaun Yang Aktif</td>
                                                    </tr>
                                                }
                                                else
                                                {
                                                    foreach (HR_ELAUN item in ViewBag.elaun3)
                                                    {
                                                        var KOD_PELARASAN_ELAUN = "";
                                                        HR_POTONGAN potongan2 = new HR_POTONGAN();
                                                        if ((ViewBag.Kod == "00026" && Model.HR_KEW8_IND == "T") || (ViewBag.Kod == "LNTKN" && Model.HR_LANTIKAN_IND == "T"))
                                                        {
                                                            potongan2 = potongan3.FirstOrDefault(s => s.HR_KOD_POTONGAN == item.HR_KOD_TUNGGAKAN);
                                                            KOD_PELARASAN_ELAUN = item.HR_KOD_TUNGGAKAN;
                                                        }
                                                        else
                                                        {
                                                            potongan2 = potongan3.FirstOrDefault(s => s.HR_KOD_POTONGAN == item.HR_KOD_POTONGAN);
                                                            KOD_PELARASAN_ELAUN = item.HR_KOD_POTONGAN;
                                                        }

                                                        if (potongan2 == null)
                                                        {
                                                            potongan2 = new HR_POTONGAN();
                                                            potongan2.HR_NILAI = 0;
                                                        }

                                                        if ((potongan2.HR_KOD_POTONGAN != null && (ViewBag.Kod == "00030" || ViewBag.Kod == "00026" || ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00015" || ViewBag.Kod == "LNTKN")) || (ViewBag.Kod != "00030" && ViewBag.Kod != "00026" && ViewBag.Kod != "TP" && ViewBag.Kod != "CUTI" && ViewBag.Kod != "00015" && ViewBag.Kod != "LNTKN"))
                                                        {
                                                            decimal? nilai = Math.Abs(Convert.ToDecimal(potongan2.HR_NILAI));
                                                            jum += nilai;

                                                            ++no2;
                                                            <tr>
                                                                <td align="center">@no2</td>
                                                                <td>@Html.DisplayFor(model => item.HR_KOD_ELAUN) @{ var txts = ""; if (item.HR_KOD_ELAUN != null) { txts = "::"; } else { txts = ""; } } @txts @Html.DisplayFor(model => item.HR_PENERANGAN_ELAUN)</td>
                                                                <td>@Html.DisplayFor(model => item.HR_NILAI)</td>
                                                                @if (ViewBag.Kod == "00030" || ViewBag.Kod == "00026" || ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00015" || ViewBag.Kod == "LNTKN")
                                                                {
                                                                    decimal HR_NILAI = 0;
                                                                    if (potongan2.HR_NILAI != null)
                                                                    {
                                                                        HR_NILAI = Convert.ToDecimal(potongan2.HR_NILAI);
                                                                    }
                                                                    <td>@(KOD_PELARASAN_ELAUN) @{ var txts2 = ""; if (KOD_PELARASAN_ELAUN != null) { txts2 = "::"; } else { txts2 = ""; } } @txts2 @Html.DisplayFor(model => potongan2.HR_PENERANGAN_POTONGAN)@Html.Hidden("[" + no2 + "].HR_KOD_CARUMAN", item.HR_KOD_ELAUN, new { @class = "form-control", id = "HR_KOD_ELAUN" })@Html.Hidden("[" + no2 + "].HR_KOD_POTONGAN", KOD_PELARASAN_ELAUN)</td>
                                                                    <td id="pelarasan"><label class="input">@Html.TextBox("[" + no2 + "].HR_NILAI", string.Format("{0:0.00}", +Math.Abs(HR_NILAI)), new { @class = "form-control", id = "HR_NILAI_PELARASAN", disabled = "disabled" })</label></td>
                                                                }
                                                            </tr>
                                                        }
                                                    }
                                                }

                                            </tbody>
                                            @if (num.Count() > 0 && (ViewBag.Kod == "00030" || ViewBag.Kod == "00026" || ViewBag.Kod == "TP" || ViewBag.Kod == "CUTI" || ViewBag.Kod == "00015" || ViewBag.Kod == "LNTKN"))
                                            {
                                                <tfoot>
                                                    <tr>
                                                        <td colspan="4" align="right"><strong>Jumlah (RM)</strong></td>
                                                        <td><label class="input">@Html.TextBox("TotalPelarasan", string.Format("{0:0.00}", jum), new { @class = "form-control", disabled = "disabled", id = "TotalPelarasan" })</label></td>
                                                    </tr>
                                                </tfoot>
                                            }
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </section>

                    }

                </div>

            </div>



        </fieldset>

        <footer>
            <button type="button" id="btn-back" class="btn btn-default">
                Kembali
            </button>
        </footer>
        }

    </div>

</div><!-- /.modal-content -->
<script type="text/javascript">
    //$("form").attr({ "id": "tp", "class": "smart-form" })
    // DO NOT REMOVE : GLOBAL FUNCTIONS!
    $(".modal-dialog").css("min-width", "80%");
    $(document).ready(function () {
        var validateform = $("#form").validate({

            // Rules for form validation
            checkForm: function () {
                this.prepareForm();
                for (var i = 0, elements = (this.currentElements = this.elements()) ; elements[i]; i++) {
                    if (this.findByName(elements[i].name).length != undefined && this.findByName(elements[i].name).length > 1) {
                        for (var cnt = 0; cnt < this.findByName(elements[i].name).length; cnt++) {
                            this.check(this.findByName(elements[i].name)[cnt]);
                        }
                    } else {
                        this.check(elements[i]);
                    }
                }
                return this.valid();
            },
            rules: {
                HR_KOD_PERUBAHAN: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "kew8") {
                            return true;
                        }
                    }
                },
                HR_TARIKH_MULA: {
                    required: true
                },
                HR_TARIKH_AKHIR: {
                    required: true
                },
                HR_KOD_PELARASAN: {
                    required: true
                },
                HR_JUMLAH_BULAN: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "00031") {
                            return true;
                        }
                    },
                    number: true
                },
                HR_NILAI_EPF: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "00031") {
                            return true;
                        }
                    },
                    number: true
                },
                HR_NILAI_PERATUS: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "00031") {
                            return true;
                        }
                    },
                    number: true
                },
                HR_TARIKH_TAMAT: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "TP") {
                            return true;
                        }
                    }
                },
                HR_NAMA_PEGAWAI: {
                    required: true,
                    remote: {
                        url: "../Kewangan8/CariPegawai",
                        type: "get",
                        data: {
                            HR_NP_FINALISED_HR: function () {
                                return $("#HR_NAMA_PEGAWAI").val();
                            }
                        }
                    }
                },
                HR_BIL: {
                    required: true,
                    number: true
                },
                HR_KEW8_IND: {
                    required: true
                },
                HR_GRED: {
                    required: true,
                    remote: {
                        url: "../Kewangan8/CariGred2",
                        type: "get",
                        data: {
                            HR_GRED: function () {
                                return $("#HR_GRED").val();
                            }
                        }
                    }
                },
                HR_GAJI_MIN_BARU: {
                    required: true,
                    number: true
                },
                HR_GAJI_MAX_BARU: {
                    required: true,
                    number: true
                },
                HR_GAJI_BARU: {
                    required: true,
                    number: true,
                    remote: {
                        url: "../Kewangan8/CariGajiBaru",
                        type: "get",
                        data: {
                            HR_GRED: function () {
                                return $("#HR_GRED").val();
                            },
                            HR_GAJI_BARU: function () {
                                return $("#HR_GAJI_BARU").val();
                            }
                        }
                    }
                },
                HR_JAWATAN_BARU: {
                    required: true
                },
                //HR_PGT_BARU: {
                //    required: true,
                //    number: true
                //},
                HR_JUMLAH_POTONGAN: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "CUTI") {
                            return true;
                        }
                    },
                    number: true,
                    max: function () {
                        var gajiBersih = parseFloat('@ViewBag.GajiBersih');
                        if ($("#bulanAnsuran").val() > 0) {
                            gajiBersih *= parseFloat($("#bulanAnsuran").val());
                        }
                        return gajiBersih;
                    }

                },
                HR_JUMLAH_PERUBAHAN_ELAUN: {
                    required: function (element) {
                        if ('@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                            return true;
                        }
                    },
                    number: true
                },
                HR_JUMLAH_PERUBAHAN_ELAUN: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja",
                }
            },

            // Messages for form validation
            messages: {
                HR_KOD_PERUBAHAN: {
                    required: "Diperlukan"
                },
                HR_TARIKH_MULA: {
                    required: "Diperlukan"
                },
                HR_TARIKH_AKHIR: {
                    required: "Diperlukan"
                },
                HR_KOD_PELARASAN: {
                    required: "Diperlukan"
                },
                HR_JUMLAH_BULAN: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja"
                },
                HR_NILAI_EPF: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja"
                },
                HR_NILAI_PERATUS: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja"
                },
                HR_TARIKH_TAMAT: {
                    required: "Diperlukan"
                },
                HR_NAMA_PEGAWAI: {
                    required: "Diperlukan",
                    remote: "Pegawai tidak wujud"
                },
                HR_BIL: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja"
                },
                HR_KEW8_IND: {
                    required: "Diperlukan"
                },
                HR_GRED: {
                    required: "Diperlukan",
                    remote: "Gred tidak wujud"
                },
                HR_GAJI_MIN_BARU: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja"
                },
                HR_GAJI_MAX_BARU: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja",
                },
                HR_GAJI_BARU: {
                    required: "Diperlukan",
                    number: "Sila masukkan hanya nombor sahaja",
                    remote: "Gaji tidak wujud"
                },
                HR_JAWATAN_BARU: {
                    required: "Diperlukan"
                },
                //HR_PGT_BARU: {
                //    required: "Diperlukan",
                //    number: "Sila masukkan hanya nombor sahaja",
                //},
                HR_JUMLAH_POTONGAN: {
                    required: "Diperlukan",
                    max: "Potongan telah melebihi gaji bersih ( {0} )"
                }
            },

            // Do not change code below
            errorPlacement: function (error, element) {
                error.insertAfter(element.parent());
            }
        });

        $("#btn-back, button.close").on("click", function () {
            history.go(0);
        })
    });

    $(document).ready(function () {

        $('#HR_TARIKH_KEYIN').datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd/mm/yy',
            prevText: '<i class="fa fa-chevron-left"></i>',
            nextText: '<i class="fa fa-chevron-right"></i>',
            onSelect: function (selectedDate) {

            }
        });

        var keyInDate = $('#HR_TARIKH_KEYIN').datepicker("getDate");
        var keyInDate2 = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1)
        var keyInDate3 = keyInDate2.getDate() + "/" + (keyInDate2.getMonth() + 1) + "/" + keyInDate2.getFullYear();

        if ('@ViewBag.Kod' == "00031") {
            nilaiPerubahan();
            function nilaiPerubahan() {
                $("#HR_JUMLAH_PERUBAHAN").val("0.00")
                if ($("#HR_NO_PEKERJA").val() != "" && $("#HR_JUMLAH_BULAN").val() != "" && $("#HR_NILAI_EPF").val() != "" && $("#HR_NILAI_PERATUS").val() != "") {
                    $.ajax({
                        url: "../Kewangan8/JumlahPerubahan",
                        type: "GET",
                        data: { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "HR_JUMLAH_BULAN": $("#HR_JUMLAH_BULAN").val(), "HR_NILAI_EPF": $("#HR_NILAI_EPF").val(), "HR_NILAI_PERATUS": $("#HR_NILAI_PERATUS").val() },
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {

                            $("#HR_JUMLAH_PERUBAHAN").val(data.toFixed(2))
                        }
                    })
                }
            }
            $("#HR_JUMLAH_BULAN, #HR_NILAI_EPF, #HR_NILAI_PERATUS").on("input", function () {
                nilaiPerubahan();
            });
        }

        if ('@ViewBag.Kod' == "kew8" || '@ViewBag.Kod' == "00015") {
            $('#HR_TARIKH_MULA').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                onSelect: function (selectedDate) {
                    $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', selectedDate);
                }
            });

            $('#HR_TARIKH_AKHIR').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                onSelect: function (selectedDate) {
                    $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', selectedDate);
                }
            });
        }
        else if ('@ViewBag.Kod' == "00031" || '@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00025") {
            $('#HR_TARIKH_MULA').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                showButtonPanel: true,
                currentText: "Bulan Kini",
                closeText: 'Tutup',
                onSelect: function (selectedDate) {
                    $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', selectedDate);
                },
                onChangeMonthYear: function (year, month, inst) {
                    $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month - 1, 1)));
                },
                onClose: function (dateText, inst) {
                    $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(inst.selectedYear, inst.selectedMonth, 1)));
                }
            }).focus(function () {
                $(".ui-datepicker-calendar").hide();
            });

            $('#HR_TARIKH_AKHIR').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                showButtonPanel: true,
                currentText: "Bulan Kini",
                closeText: 'Tutup',
                onSelect: function (selectedDate) {
                    $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', selectedDate);
                },

                onChangeMonthYear: function (year, month, inst) {
                    $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month, 0)));
                },
                onClose: function (dateText, inst) {
                    $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(inst.selectedYear, inst.selectedMonth + 1, 0)));
                }
            }).focus(function () {
                $(".ui-datepicker-calendar").hide();
            });
        }
        else if ('@ViewBag.Kod' == "TP") {
            $('#HR_TARIKH_TAMAT').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                onSelect: function (selectedDate) {

                    //$('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', selectedDate);
                    if ($('#HR_TARIKH_MULA').val() != "" && $('#HR_KOD_PERUBAHAN').val() != "") {
                        //var endDate = $('#HR_TARIKH_TAMAT').datepicker("getDate");
                        //var startDate = new Date();

                        var startDate = $('#HR_TARIKH_TAMAT').datepicker("getDate");
                        var endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0)

                        HasilKiraan(startDate, endDate);
                    }

                }
            });
        }
        else if ('@ViewBag.Kod' != "00039" && '@ViewBag.Kod' != "00024") {
            getDP()
        }

        function getDP() {
            $('#HR_TARIKH_MULA').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                onSelect: function (selectedDate) {
                    $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', selectedDate);

                    if ('@ViewBag.Kod' == "00026") {
                        if ($('#HR_TARIKH_MULA').val() != "" && $("#HR_KEW8_IND:checked").val() == "B") {
                            var endDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                            var startDate = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1);
                            var startDate2 = 1 + "/" + (keyInDate.getMonth() + 1) + "/" + keyInDate.getFullYear();
                            var endDate2 = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear();
                            HasilKiraan(startDate, endDate);
                        }
                        else if ($('#HR_TARIKH_AKHIR').val() != "" && $("#HR_KEW8_IND:checked").val() == "T") {
                            var endDate = $('#HR_TARIKH_AKHIR').datepicker("getDate");
                            var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                            var startDate2 = startDate.getDate() + "/" + (startDate.getMonth() + 1) + "/" + startDate.getFullYear();
                            var endDate2 = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear();
                            HasilKiraan(startDate, endDate);
                        }

                    }

                    if (('@ViewBag.Kod' == "00036" && $('#HR_TARIKH_MULA').val() != "" && $('#HR_GAJI_BARU').val() != "")) {
                        //var crrDate = new Date();
                        var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                        var endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0)

                        HasilKiraan(startDate, endDate);
                    }

                    if (('@ViewBag.Kod' == "CUTI" && $('#HR_KOD_PERUBAHAN').val() == "00017") && $('#HR_TARIKH_MULA').val() != "" && $('#HR_TARIKH_AKHIR').val() != "") {
                        var startDate = $(this).val();
                        var endDate = $('#HR_TARIKH_AKHIR').val();
                        var gaji = parseFloat($("#HR_GAJI_LAMA").val());
                        gaji /= 2;
                        //ajaxHasilAkhirNilai(startDate, endDate, gaji, $('#HR_KOD_PERUBAHAN').val(), "G")
                        jumPelarasan2(startDate, endDate, gaji)
                    }

                    if (('@ViewBag.Kod' == "00039" || '@ViewBag.Kod' == "00024") && $("#HR_KEW8_IND:checked").val() == "E") {
                        ajaxPelarasan($("#HR_KOD_PELARASAN").val(), parseFloat($("#HR_JUMLAH_PERUBAHAN_ELAUN").val()), $('#HR_TARIKH_MULA').datepicker("getDate"), 0)
                    }

                    if ('@ViewBag.Kod' == "LNTKN") {
                        //var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                        //var endDate = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1);

                        var startDate = $(this).val();
                        var endDate = $('#HR_TARIKH_AKHIR').val();
                        var gaji = parseFloat($("#HR_GAJI_LAMA").val());

                        ajaxHasilAkhirNilai(startDate, endDate, gaji, '@ViewBag.Kod', "G")
                        jumPelarasan2(startDate, endDate, gaji)
                        //HasilKiraan(startDate, endDate);
                    }

                    if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                        var startDate = $(this).val();
                        var endDate = $('#HR_TARIKH_AKHIR').val();
                        var gaji = parseFloat($("#HR_GAJI_MIN_BARU").val());

                        if ($(this).datepicker("getDate") > keyInDate2) {
                            $("#changeJumTxt").text("Jumlah Potongan")
                        }
                        else {
                            $("#changeJumTxt").text("Jumlah Tunggakan")
                        }
                        if ($("#HR_TARIKH_MULA").val() != "" && $("#HR_TARIKH_AKHIR").val() != "" && $("#HR_GRED").val() != "" && $("#HR_GAJI_MIN_BARU").val() != "") {
                            if ($("#HR_KOD_PERUBAHAN").val() == "00032") {
                                //var data = ajaxGajiMin($("#HR_GRED").val());
                                ajaxHasilNilai(startDate, endDate, gaji, '@ViewBag.Kod')
                            }
                            else {
                                ajaxHasilNilaiMemangku(startDate, endDate, $("#HR_GAJI_LAMA").val(), gaji)
                            }
                        }
                    }
                }
            });


            $('#HR_TARIKH_AKHIR').datepicker({
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
                onSelect: function (selectedDate) {
                    if (('@ViewBag.Kod' != "LNTKN") || ('@ViewBag.Kod' == "LNTKN" && $("#HR_LANTIKAN_IND:checked").val() == "P")) {
                        $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', selectedDate);
                    }

                    if ('@ViewBag.Kod' == "00026") {
                        if ($('#HR_TARIKH_MULA').val() != "" && $("#HR_KEW8_IND:checked").val() == "B") {
                            var endDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                            var startDate = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1);
                            var startDate2 = 1 + "/" + (keyInDate.getMonth() + 1) + "/" + keyInDate.getFullYear();
                            var endDate2 = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear();
                            HasilKiraan(startDate, endDate);
                        }
                        else if ($('#HR_TARIKH_AKHIR').val() != "" && $("#HR_KEW8_IND:checked").val() == "T") {
                            var endDate = $('#HR_TARIKH_AKHIR').datepicker("getDate");
                            var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                            var startDate2 = startDate.getDate() + "/" + (startDate.getMonth() + 1) + "/" + startDate.getFullYear();
                            var endDate2 = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear();
                            HasilKiraan(startDate, endDate);
                        }
                    }

                    if (('@ViewBag.Kod' == "CUTI" && $('#HR_KOD_PERUBAHAN').val() == "00017") && $('#HR_TARIKH_MULA').val() != "" && $('#HR_TARIKH_AKHIR').val() != "") {
                        var startDate = $('#HR_TARIKH_MULA').val();
                        var endDate = $(this).val();
                        var gaji = parseFloat($("#HR_GAJI_LAMA").val());
                        gaji /= 2;
                        //ajaxHasilAkhirNilai(startDate, endDate, gaji, $('#HR_KOD_PERUBAHAN').val(), "G")
                        jumPelarasan2(startDate, endDate, gaji)
                    }

                    if ('@ViewBag.Kod' == "00024" && $("#HR_KEW8_IND:checked").val() == "P") {
                        ajaxPelarasan($("#HR_KOD_PELARASAN").val(), parseFloat($("#HR_JUMLAH_PERUBAHAN_ELAUN").val()), $('#HR_TARIKH_AKHIR').datepicker("getDate"), 0)
                    }

                    if ('@ViewBag.Kod' == "LNTKN") {
                        //var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                        //var endDate = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1);

                        var startDate = $('#HR_TARIKH_MULA').val();
                        var endDate = $(this).val();
                        var gaji = parseFloat($("#HR_GAJI_LAMA").val());

                        ajaxHasilAkhirNilai(startDate, endDate, gaji, '@ViewBag.Kod', "G")
                        jumPelarasan2(startDate, endDate, gaji)
                        //HasilKiraan(startDate, endDate);
                    }

                    if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                        var startDate = $('#HR_TARIKH_MULA').val();
                        var endDate = $(this).val();
                        var gaji = parseFloat($("#HR_GAJI_MIN_BARU").val());

                        if ($("#HR_TARIKH_MULA").val() != "" && $("#HR_TARIKH_AKHIR").val() != "" && $("#HR_GRED").val() != "" && $("#HR_GAJI_MIN_BARU").val() != "") {
                            if ($("#HR_KOD_PERUBAHAN").val() == "00032") {
                                //var data = ajaxGajiMin($("#HR_GRED").val());
                                ajaxHasilNilai(startDate, endDate, gaji, '@ViewBag.Kod')
                            }
                            else {
                                ajaxHasilNilaiMemangku(startDate, endDate, $("#HR_GAJI_LAMA").val(), gaji)
                            }
                        }
                    }
                }
            });
        }

        if ('@ViewBag.Kod' == "00039" || '@ViewBag.Kod' == "00024") {
            function KodPelarasan(Value) {
                $("#HR_KOD_PELARASAN").html("<option></option>");
                $.ajax({
                    url: "../Kewangan8/KodPelarasan",
                    type: "GET",
                    data: { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "Kod": '@ViewBag.Kod', "Value": Value },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        $.each(data, function (i, v) {
                            if ('@ViewBag.Kod' == "00024") {
                                $("#HR_KOD_PELARASAN").append($("<option></option>").val(v.HR_KOD_ELAUN).html(v.HR_PENERANGAN_ELAUN));
                            }
                            if ('@ViewBag.Kod' == "00039") {
                                $("#HR_KOD_PELARASAN").append($("<option></option>").val(v.HR_KOD_POTONGAN).html(v.HR_PENERANGAN_POTONGAN));
                            }
                        })
                    }
                })
            }

            function JumlahBulan2(startDate, endDate) {
                var currentDate = new Date(startDate);
                var currentDate2 = new Date(startDate);
                var totalMonth = 0;
                if (currentDate < endDate) {
                    while (currentDate < endDate) {

                        currentDate.setMonth(currentDate.getMonth() + 1);
                        totalMonth++;
                    }
                }
                if (currentDate2 > endDate && $("#HR_KEW8_IND:checked").val() == "P") {
                    while (currentDate2 > endDate) {
                        currentDate2.setMonth(currentDate2.getMonth() - 1);
                        totalMonth--;
                    }
                }
                return totalMonth;
            }

            function JumlahBulan(startDate, endDate) {
                var currentDate = new Date(startDate);
                var currentDate2 = new Date(startDate);
                var totalMonth = 0;
                if (currentDate < endDate) {
                    while (currentDate < endDate) {

                        currentDate.setDate(currentDate.getDate() + 1);
                        totalMonth++;
                    }
                }
                if (currentDate2 > endDate && $("#HR_KEW8_IND:checked").val() == "P") {
                    while (currentDate2 > endDate) {
                        currentDate2.setDate(currentDate2.getDate() - 1);
                        totalMonth--;
                    }
                }

                return totalMonth;
            }

            function xPotongan(nilai, startDate) {
                var totalMonth = 0;
                var nilai2 = 0;
                var bilHari = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0);
                var currentDate2 = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
                var endDate = new Date(startDate);
                if (currentDate2 < endDate) {
                    while (currentDate2 < endDate) {
                        currentDate2.setDate(currentDate2.getDate() + 1);
                        totalMonth++;
                    }
                }

                if (totalMonth > 0) {
                    nilai2 = nilai * totalMonth / bilHari.getDate();
                }

                return nilai2;
            }

            function jumPerubahan(nilai, startDate) {
                //var endDate = tarikh;
                var date = '@string.Format("{0:MM/dd/yyyy}", Model.HR_TARIKH_KEYIN)';
                var endDate = new Date(date);

                var endDate2 = new Date(endDate.getFullYear(), endDate.getMonth(), 1);
                var bilHari = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0);
                var nilai2 = 0;

                //if (startDate.getDate() == 1 || (startDate.getDate() == 2 && $("#HR_KEW8_IND:checked").val() == "E"))
                if (startDate.getDate() == 1) {

                    nilai2 = nilai * JumlahBulan2(startDate, endDate2);
                }
                else if (startDate > keyInDate2 && $("#HR_KEW8_IND:checked").val() == "E") {
                    nilai2 = xPotongan(nilai, startDate);
                }
                else {
                    var nilai3 = Math.abs(nilai * JumlahBulan2(new Date(startDate.getFullYear(), startDate.getMonth(), 1), endDate2)) - Math.abs(nilai * JumlahBulan(new Date(startDate.getFullYear(), startDate.getMonth(), 1), endDate2) / bilHari.getDate());
                    nilai2 = (nilai * JumlahBulan(startDate, endDate2) / bilHari.getDate()) + nilai3;
                }

                //'jika totalMonth lebih kecil daripada 0' atau boleh juga buat 'jika $("#HR_KEW8_IND:checked").val() == "P"'
                if (JumlahBulan(startDate, endDate2) < 0) {
                    nilai2 = nilai + nilai2;
                }

                if (isNaN(nilai2)) {
                    nilai2 = 0;
                }

                $("#HR_JUMLAH_PERUBAHAN").val(nilai2.toFixed(2));

                if ($("#HR_KEW8_IND:checked").val() == "P" || (startDate > keyInDate2 && $("#HR_KEW8_IND:checked").val() == "E")) {
                    $("#jumTxt").text("Potongan")
                    $("#HR_KOD_POTONGAN").val('@ViewBag.kodPGaji');
                }
                else {
                    $("#jumTxt").text("Tunggakan")
                    $("#HR_KOD_POTONGAN").val('@ViewBag.kodTGaji');
                }
            }

            function ajaxPelarasan(KodElaun, nilai, tarikhMula, kod) {
                if (nilai == null) {
                    nilai = 0
                }
                $.ajax({
                    url: "../Kewangan8/CariJumlahPotonganElaun",
                    type: "GET",
                    data: { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "Kod": '@ViewBag.Kod', "KodElaun": KodElaun },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        getDP();
                        var mula = new Date();

                        if (kod == 1 && data.HR_TARIKH_AKHIR != null) {
                            var akhir = new Date(parseInt(data.HR_TARIKH_AKHIR.substr(6)));
                            $('#HR_TARIKH_AKHIR').val(akhir.toLocaleDateString('en-GB'));
                            //$("#HR_TARIKH_MULA").datepicker().datepicker('option', 'maxDate', akhir);
                        }

                        if (kod == 1) {
                            mula = new Date(parseInt(data.HR_TARIKH_MULA.substr(6)));
                            $('#HR_TARIKH_MULA').val(mula.toLocaleDateString('en-GB'));
                            $("#HR_JUMLAH_PERUBAHAN_ELAUN").val(data.HR_JUMLAH.toFixed(2));
                            if ($("#HR_KEW8_IND:checked").val() == "P") {

                                if (data.HR_TARIKH_AKHIR != null && '@ViewBag.Kod' == "00024") {
                                    jumPerubahan(parseFloat(data.HR_JUMLAH), akhir)
                                }
                                else {
                                    $("#HR_JUMLAH_PERUBAHAN").val("0.00");
                                }

                            }
                            else {
                                jumPerubahan(parseFloat(data.HR_JUMLAH), mula)
                            }
                        }
                        else if ('@ViewBag.Kod' == '00024' || ('@ViewBag.Kod' == '00039' && $("#HR_KEW8_IND:checked").val() == "E")) {
                            jumPerubahan(parseFloat(nilai), tarikhMula)
                        }

                        if (data.HR_KOD_ELAUN_POTONGAN == null && '@ViewBag.Kod' == "00039") {
                            $('#HR_TARIKH_MULA').datepicker("destroy");
                        }

                        $("#HR_TARIKH_AKHIR").datepicker().datepicker('option', 'minDate', $('#HR_TARIKH_MULA').val());
                    }
                });
            }

            function ConvertTarikhMula(nilai, tarikh) {
                $.ajax({
                    url: "../Kewangan8/ConvertTarikhMula",
                    type: "GET",
                    data: { "tarikh": tarikh },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        ajaxPelarasan($("#HR_KOD_PELARASAN").val(), nilai, new Date(data), 0)
                    }
                });
            }

            $("#HR_KOD_PELARASAN").on("input", function () {

                if ($(this).val() != "") {
                    getDP()
                }
                else {
                    $('#HR_TARIKH_MULA').datepicker("destroy");
                    $('#HR_TARIKH_AKHIR').datepicker("destroy");
                }

                $("#HR_JUMLAH_PERUBAHAN_ELAUN").val("");
                $("#HR_JUMLAH_PERUBAHAN").val("");
                $('#HR_TARIKH_MULA').val("");
                $('#HR_TARIKH_AKHIR').val("");
                $('#HR_BUTIR_PERUBAHAN').val("");
                $('#HR_NO_SURAT_KEBENARAN').val("");
                $('#HR_CATATAN').val("");

                ajaxPelarasan($(this).val(), null, null, 1)

                if ($("#HR_KEW8_IND:checked").val() != "P") {
                    $("#HR_JUMLAH_PERUBAHAN_ELAUN").removeAttr("readonly");
                    $("#HR_JUMLAH_PERUBAHAN").attr("readonly", "readonly");
                }
                else {
                    if ('@ViewBag.Kod' == "00039") {
                        $("#HR_JUMLAH_PERUBAHAN_ELAUN").attr("readonly", "readonly");
                        $("#HR_JUMLAH_PERUBAHAN").removeAttr("readonly");
                    }
                    else {
                        $("#HR_JUMLAH_PERUBAHAN_ELAUN").removeAttr("readonly");
                        $("#HR_JUMLAH_PERUBAHAN").attr("readonly", "readonly");
                    }
                }
            })

            $("#HR_JUMLAH_PERUBAHAN_ELAUN").on("input", function () {
                if ($("#HR_KEW8_IND:checked").val() == "P") {
                    if ($("#HR_TARIKH_AKHIR").val() != "") {
                        ConvertTarikhMula(parseFloat($(this).val()), $("#HR_TARIKH_AKHIR").val())
                    }

                }
                else {
                    if ($("#HR_TARIKH_MULA").val() != "") {
                        ConvertTarikhMula(parseFloat($(this).val()), $("#HR_TARIKH_MULA").val())
                    }

                }
            })
        }

        $("#HR_NAMA_PEGAWAI").on('input', function () {
            $("#statusdata").html("");

            if ($(this).val().length >= 4) {
                $.get("../Kewangan8/CariPegawai2", { HR_NP_FINALISED_HR: $(this).val() }, function (data) {
                    if (data != false) {
                        $("#HR_NAMA_PEGAWAI").val(data.HR_NAMA_PEKERJA);
                        $("#HR_NP_FINALISED_HR").val(data.HR_NO_PEKERJA);

                        if ('@ViewBag.HR_NAMA_PEGAWAI' == data.HR_NAMA_PEKERJA) {
                            var html = '<section>' +
                                            '<div class="row">' +
                                                '<label class="label col col-4">Status Data</label>' +
                                                '<div class="col col-8">' +
                                                    '<label class="select">' +
                                                        '<select class="form-control" id="HR_FINALISED_IND_HR" name="HR_FINALISED_IND_HR">' +
                                                            '<option value="T">Baru</option>' +
                                                            '<option value="P">Proses</option>' +
                                                            '<option value="Y">Muktamad</option>' +
                                                        '<select>' +
                                                    '</label>' +
                                                '</div>' +
                                            '</div>' +
                                        '</section>';
                            $("#statusdata").html(html);
                        }
                        else {
                            $("#statusdata").html("");
                        }
                    }
                })

                //$.ajax({
                //    url: "../Kewangan8/CariPegawai2",
                //    type: "GET",
                //    data: { "HR_NP_FINALISED_HR": $("#HR_NAMA_PEGAWAI").val() },
                //    dataType: "json",
                //    contentType: "application/json; charset=utf-8",
                //    success: function (data) {
                //        if(data != false)
                //        {
                //            $("#HR_NAMA_PEGAWAI").val(data.HR_NAMA_PEKERJA);
                //            $("#HR_NP_FINALISED_HR").val(data.HR_NO_PEKERJA);
                //        }
                //    }
                //})
            }
            //var value = $(this).val();
            //var d = value.split(' - ')
            //$(this).val(d[0]);
            //$("#HR_NP_FINALISED_HR").val(d[1]);



        });

        $("#HR_NAMA_PEGAWAI").on("click", function () {
            $(this).focus(function () { $(this).select(); });
        })

        if ('@ViewBag.Kod' == "LNTKN") {
            function lantikanInd(view) {

                if (view == 1) {
                    $("#tableElaun table tbody").each(function () {
                        $(this).find("td#pelarasan").html("");
                        //$(this).find("td").addClass("hide");
                    })
                }

                var firstDayofMonth = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1)

                if ($("#HR_LANTIKAN_IND:checked").val() == "P") {
                    $("#txtTarikhMula").text("Tarikh Mula Bayar Gaji");
                    $("#txtTarikhAkhir").text("Tarikh Akhir");
                    //$("#HR_TARIKH_MULA").val("");
                    //$("#HR_TARIKH_AKHIR").val("");
                    $("#tukarTajukPotonganGaji").text("Julmah Potongan Gaji");
                    $("#tukarTajukElaun").text("Maklumat Potongan Elaun");
                    $("#HR_KOD_POTONGAN").val('@ViewBag.kodPGaji');
                    $('#HR_TARIKH_MULA').datepicker('option', 'minDate', firstDayofMonth);
                    $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', firstDayofMonth);
                    $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', null);
                    if ($("#HR_TARIKH_AKHIR").val() != "") {
                        $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', $("#HR_TARIKH_AKHIR").datepicker("getDate"));
                    }

                    if (view == 1) {
                        jumPelarasan2(null, null, null)
                    }

                }
                else {
                    $("#txtTarikhMula").text("Tarikh Mula Tunggakan Gaji");
                    $("#txtTarikhAkhir").text("Tarikh Akhir");
                    //$("#HR_TARIKH_MULA").val("");
                    //$("#HR_TARIKH_AKHIR").val("");
                    $("#tukarTajukPotonganGaji").text("Julmah Tunggakan Gaji");
                    $("#tukarTajukElaun").text("Maklumat Tunggakan Elaun");
                    $("#HR_KOD_POTONGAN").val('@ViewBag.kodTGaji');
                    $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', firstDayofMonth);
                    $('#HR_TARIKH_MULA').datepicker('option', 'minDate', null);
                    $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', null);

                    if (view == 1) {
                        jumPelarasan2(null, null, null)
                    }

                }

                if ($("#HR_TARIKH_MULA").val() != "") {
                    $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', $("#HR_TARIKH_MULA").datepicker("getDate"));
                }
            }
            $("input[name='HR_LANTIKAN_IND']").on("click", function () {
                lantikanInd(1);
            });
            lantikanInd(0);
        }

        if ('@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
            $("#HR_JUMLAH_PERUBAHAN_ELAUN").removeAttr("readonly");
        }

        if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "CUTI") {
            function AnsuranBulanan(bilBulan, amaun, no, data, jenis) {
                var html = "";
                if (!isNaN(amaun)) {
                    var total = 0;

                    if ('@ViewBag.Kod' == "00030") {
                        total = amaun / bilBulan;
                    }

                    html = '<section>' +
                                    '<div class="row">' +
                                        '<div class="col col-12">' +
                                        '<table class="table table-striped table-bordered table-hover" width="100%">' +
                                        '<tr>' +
                                            '<th>Tarikh Mula</th>' +
                                            '<th>Tarikh Akhir</th>' +
                                            '<th>Amaun</th>' +
                                        '</tr>';

                    for (var i = 0; i < bilBulan; i++) {

                        var tarikhMula = $.datepicker.formatDate('dd/mm/yy', new Date(new Date().getFullYear(), new Date().getMonth() + i, 1));
                        var tarikhAkhir = $.datepicker.formatDate('dd/mm/yy', new Date(new Date().getFullYear(), new Date().getMonth() + (i + 1), 0));

                        if (data != null) {
                            tarikhMula = $.datepicker.formatDate('dd/mm/yy', new Date(parseInt(data[i].HR_TARIKH_MULA_ANSURAN.substr(6))));
                            tarikhAkhir = $.datepicker.formatDate('dd/mm/yy', new Date(parseInt(data[i].HR_TARIKH_AKHIR_ANSURAN.substr(6))));
                        }

                        if ('@ViewBag.Kod' == "CUTI") {
                            total = ajaxKiraPelarasan(tarikhMula, tarikhAkhir, tarikhAkhir, amaun, "00017", jenis)
                        }

                        html += '<tr>' +
                                    '<td>' +
                                        '<label class="input">' +
                                            '<input name="[' + no + '][' + i + '].HR_TARIKH_MULA" type="text" class="form-control HR_TARIKH_MULA_ANSURAN" value="' + tarikhMula + '" id="HR_TARIKH_MULA_ANSURAN" disabled="disabled" />' +
                                        '</label>' +
                                    '</td>' +
                                    '<td>' +
                                        '<label class="input">' +
                                            '<input name="[' + no + '][' + i + '].HR_TARIKH_AKHIR" type="text" class="form-control HR_TARIKH_AKHIR_ANSURAN" value="' + tarikhAkhir + '" id="HR_TARIKH_AKHIR_ANSURAN" disabled="disabled" />' +
                                        '</label>' +
                                    '</td>' +
                                    '<td>' +
                                        '<label class="input">' +
                                            '<input name="[' + no + '][' + i + '].HR_BIL" type="text" class="form-control" value="' + total.toFixed(2) + '" id="HR_BIL_ANSURAN" disabled="disabled" />' +
                                        '</label>' +
                                    '</td>' +
                                '</tr>';
                    }

                    html += '</table>' +
                                '</div>' +
                                '</div>' +
                            '</section>';
                }
                return html;
            }

            function AnsuranElaunBulanan(bilBulan, data) {
                var no = 1;
                var txt = "Ansuran";
                if ('@ViewBag.Kod' == "CUTI") {
                    txt = "Potongan Bulanan"
                }
                $("#tableElaun tbody tr:not(#AnsuranRow)").each(function () {
                    var nilai = 0;
                    if ($(this).find("td input#HR_NILAI_PELARASAN").val() != "") {
                        nilai = parseFloat($(this).find("td input#HR_NILAI_PELARASAN").val());
                        var linkText = $(this).find("td:eq(1)").text();
                        $(this).find("td:eq(1)").html('<a id="linkAnsuran" href="#" title="Maklumat ' + txt + '">' + linkText + '</a>');
                    }

                    if ('@ViewBag.Kod' == "CUTI") {
                        if ($(this).find("td:eq(2)").text() != "") {
                            nilai = parseFloat($(this).find("td:eq(2)").text()) / 2;
                        }
                    }

                    var html2 = $('<tr id="AnsuranRow"><td colspan="5">' + AnsuranBulanan(bilBulan, nilai, no, data, "P") + '</td></tr>').insertAfter($(this));
                    html2.toggle("hide");
                    no++
                });
            }

            function PadamAnsuranBulanan() {
                $("#tableAnsuran").html("");

                $("#tableElaun tbody tr").each(function () {
                    var linkText = $(this).not("#AnsuranRow").find("td:eq(1) a").text();
                    if (linkText.length > 0) {
                        $(this).not("#AnsuranRow").find("td:eq(1)").html(linkText);
                    }
                    if ($(this).is(":visible") == false || $(this).is("#AnsuranRow") == true) {
                        $(this).remove()
                    }

                });
            }

            $("#tableElaun").on("click", "#linkAnsuran", function () {
                if ($(this).parents("tr").next().attr("id") == "AnsuranRow") {
                    var nextRow = $(this).parents("tr").next().slideToggle();
                }
            })

            function AjaxAnsuran() {
                $.ajax({
                    url: "../Kewangan8/DataAnsuran",
                    type: "GET",
                    data: { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "HR_KOD_PERUBAHAN": $("#HR_KOD_PERUBAHAN").val(), "HR_ANSURAN_ID": $("#HR_ANSURAN_ID").val() },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (ansuran) {
                        if (ansuran != null) {
                            var jum = ansuran.length;

                            //var tMula = new Array();
                            //$.each(ansuran, function (i, v) {
                            //    if (v.HR_TARIKH_MULA != null) {
                            //        var date = new Date(parseInt(v.HR_TARIKH_MULA.substr(6)))
                            //        tMula.push(date.toLocaleDateString('en-GB'))
                            //    }

                            //})

                            //var tAkhir = new Array();
                            //$.each(ansuran, function (i, v) {
                            //    if (v.HR_TARIKH_AKHIR) {
                            //        var date = new Date(parseInt(v.HR_TARIKH_AKHIR.substr(6)))
                            //        tAkhir.push(date.toLocaleDateString('en-GB'))
                            //    }

                            //})

                            var gaji = 0;

                            if ('@ViewBag.Kod' == "00030") {
                                var gajiTxt = $("#HR_JUMLAH_POTONGAN_GAJI").val();
                                if (gajiTxt != "") {
                                    gaji = parseFloat(gajiTxt);
                                }
                                //gaji

                                var html = '<section>' +
                                            '<div class="row">' +
                                                '<label class="label col col-4">Bil. Bulan</label>' +
                                                '<div class="col col-3">' +
                                                    '<label class="input">' +
                                                        '<input name="bulanAnsuran" type="number" class="form-control" value="' + jum + '" id="bulanAnsuran" disabled="disabled" />' +
                                                    '</label>' +
                                                '</div>' +
                                            '</div>' +
                                       '</section>' +
                                       '<div id="tableAnsuran">' +

                                       '</div>';
                                $("#dataAnsuran").html(html);
                            }
                            else {
                                var gajiTxt = $("#HR_GAJI_LAMA").val();

                                if (gajiTxt != "") {
                                    gaji = parseFloat(gajiTxt) / 2;
                                }
                                var startDate = $('#HR_TARIKH_MULA').val();
                                var endDate = $('#HR_TARIKH_AKHIR').val();
                                var potoganGaji = ajaxKiraPelarasan(startDate, endDate, endDate, gaji, "00017", "G");
                                $("#HR_JUMLAH_POTONGAN_GAJI").val(potoganGaji.toFixed(2))
                            }
                            if (jum > 1) {


                                $("#tableAnsuran").html(AnsuranBulanan(jum, gaji, 0, ansuran, "G"));
                                var no = 1;
                                $("#tableElaun tbody tr").each(function () {
                                    var nilai = 0;
                                    var txt = "Ansuran";
                                    if ('@ViewBag.Kod' == "CUTI") {
                                        txt = "Potongan Bulanan"
                                    }
                                    var linkText = $(this).find("td:eq(1)").text();
                                    $(this).find("td:eq(1)").html('<a id="linkAnsuran" href="#" title="Maklumat ' + txt + '">' + linkText + '</a>');

                                    if ('@ViewBag.Kod' == "00030") {
                                        if ($(this).find("td input#HR_NILAI_PELARASAN").val() != "") {
                                            nilai = parseFloat($(this).find("td input#HR_NILAI_PELARASAN").val());

                                            if (nilai != "") {
                                                nilai = nilai * jum;
                                            }

                                            $(this).find("td:eq(4) input").val((nilai).toFixed(2))
                                        }
                                    }
                                    else {
                                        var startDate = $('#HR_TARIKH_MULA').val();
                                        var endDate = $('#HR_TARIKH_AKHIR').val();
                                        //jumPelarasan2(startDate, endDate, gaji)

                                        var potoganElaun = 0;
                                        if ($(this).find("td:eq(2)").text() != "") {
                                            nilai = parseFloat($(this).find("td:eq(2)").text()) / 2;
                                            potoganElaun = ajaxKiraPelarasan(startDate, endDate, endDate, nilai, "00017", "P");

                                        }
                                        $(this).find("td input#HR_NILAI_PELARASAN").val(potoganElaun.toFixed(2));
                                    }

                                    var html2 = $('<tr id="AnsuranRow"><td colspan="5">' + AnsuranBulanan(jum, nilai, no, ansuran, "P") + '</td></tr>').insertAfter($(this));
                                    html2.toggle("hide");
                                    no++
                                });
                            }

                            if ('@ViewBag.Kod' == "00030") {
                                var totalPelarasan = $("#tableElaun tfoot tr td input#TotalPelarasan").val()
                                var jumPelarasan = 0;
                                if (totalPelarasan != "") {
                                    jumPelarasan = parseFloat($("#tableElaun tfoot tr td input#TotalPelarasan").val()) * jum
                                }
                                $("#tableElaun tfoot tr td input#TotalPelarasan").val((jumPelarasan).toFixed(2))
                                var jumPot = parseFloat(gaji) + parseFloat((jumPelarasan).toFixed(2))
                                $('#HR_JUMLAH_POTONGAN').val((jumPot).toFixed(2));

                                TarikhAnsuran();
                            }
                        }
                    }
                });
            }
            AjaxAnsuran();
        }

        if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "00039" || '@ViewBag.Kod' == "00024" || '@ViewBag.Kod' == "00026") {
            if ('@ViewBag.Kod' != "00039" && '@ViewBag.Kod' != "00024") {
                if ('@Model.HR_KEW8_IND' == "A") {
                    //$("#HR_BIL2").removeAttr("disabled");

                    $("input[name='hari']").attr("disabled", "disabled");
                    $("select[name='bulan']").attr("disabled", "disabled");
                    //$(".tambah").attr("disabled", "disabled");
                    //$(".padam").attr("disabled", "disabled");
                    $("#HR_BIL3").attr("disabled", "disabled");
                    //$("#HR_JUMLAH_POTONGAN_GAJI").attr("disabled", "disabled");
                    //$("#HR_JUMLAH_POTONGAN").attr("disabled", "disabled");



                    $("input[name='hari']").val("");
                    $("select[name='bulan']").val("");
                    $("#HR_BIL3").val("");
                    //$("#HR_JUMLAH_POTONGAN_GAJI").val("");
                    //$("#HR_JUMLAH_POTONGAN").val("");

                    //$("#tableElaun table tbody").html("<tr><td id='emptyData' align='center' colspan='6' style='padding:20px'>Tiada Data</td></tr>")
                }
                if ('@Model.HR_KEW8_IND' == "H") {
                    $("#HR_BIL2").attr("disabled", "disabled");
                    $("#HR_BIL2").val("");
                    $("#ansuran").attr("disabled", "disabled");
                    $("#dataAnsuran").html("");
                    $("#tableAnsuran").html("");
                    var HR_BIL3 = $("#HR_BIL3").val();
                    $("#HR_BIL3").val(parseInt(HR_BIL3));

                    //$("input[name='hari']").removeAttr("disabled");
                    //$("select[name='bulan']").removeAttr("disabled");
                    //$(".tambah").removeAttr("disabled");
                    //$(".padam").removeAttr("disabled");
                    //$("#HR_BIL3").removeAttr("disabled");
                    //$("#HR_JUMLAH_POTONGAN_GAJI").removeAttr("disabled");
                    //$("#HR_JUMLAH_POTONGAN").removeAttr("disabled");

                    //jumPelarasan(new Array())
                }

                if ($("#HR_KEW8_IND:checked").val() == "B") {
                    $("#txtTarikhMula").text("Tarikh Mula Bayar Gaji");
                    $("#txtTarikhAkhir").text("Tarikh Akhir Bayar Gaji");
                    $("#tukarTajukPotonganGaji").text("Julmah Potongan Gaji");
                    $("#tukarTajukElaun").text("Maklumat Potongan Elaun");

                    if ('@ViewBag.Kod' == "00026" && $('#HR_TARIKH_MULA').val() != "") {
                        var endDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                        var startDate = new Date(keyInDate.getFullYear(), keyInDate.getMonth(), 1);
                        var startDate2 = 1 + "/" + (keyInDate.getMonth() + 1) + "/" + keyInDate.getFullYear();
                        var endDate2 = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear();
                        HasilKiraan(startDate, endDate);
                    }
                }
                if ($("#HR_KEW8_IND:checked").val() == "T") {
                    $("#txtTarikhMula").text("Tarikh Mula Tunggakan Gaji");
                    $("#txtTarikhAkhir").text("Tarikh Akhir Tunggakan Gaji");
                    $("#tukarTajukPotonganGaji").text("Julmah Tunggakan Gaji");
                    $("#tukarTajukElaun").text("Maklumat Tunggakan Elaun");

                    if ('@ViewBag.Kod' == "00026" && $('#HR_TARIKH_AKHIR').val() != "") {
                        var endDate = $('#HR_TARIKH_AKHIR').datepicker("getDate");
                        var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                        var startDate2 = startDate.getDate() + "/" + (startDate.getMonth() + 1) + "/" + startDate.getFullYear();
                        var endDate2 = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear();
                        HasilKiraan(startDate, endDate);
                    }
                }
            }
            else {
                getDP();
                if ($("#HR_KEW8_IND:checked").val() != "P") {
                    ajaxPelarasan($("#HR_KOD_PELARASAN").val(), '@ViewBag.HR_JUMLAH_PERUBAHAN_ELAUN', new Date('@(string.Format("{0:MM/dd/yyyy}", Model.HR_TARIKH_MULA))'), 0);
                    $("#HR_JUMLAH_PERUBAHAN_ELAUN").removeAttr("readonly");
                    $("#HR_JUMLAH_PERUBAHAN").attr("readonly", "readonly");
                    $("#jumTxt").html("Tunggakan");

                }
                else {
                    if ('@ViewBag.Kod' == "00039") {
                        ajaxPelarasan($("#HR_KOD_PELARASAN").val(), '@ViewBag.HR_JUMLAH_PERUBAHAN_ELAUN', new Date('@(string.Format("{0:MM/dd/yyyy}", Model.HR_TARIKH_AKHIR))'), 0);

                        $("#HR_JUMLAH_PERUBAHAN_ELAUN").attr("readonly", "readonly");
                        $("#HR_JUMLAH_PERUBAHAN").removeAttr("readonly");

                    }
                    else {
                        $("#HR_JUMLAH_PERUBAHAN_ELAUN").removeAttr("readonly");
                        $("#HR_JUMLAH_PERUBAHAN").attr("readonly", "readonly");
                    }
                    $("#jumTxt").html("Potongan");
                }
            }

            $("input[name='HR_KEW8_IND']").on("click", function () {
                if ('@ViewBag.Kod' != "00039" && '@ViewBag.Kod' != "00024") {
                    if ($("select[name='bulan']").val() == "" || $("input[name='hari']").val() == "" || $("#HR_KEW8_IND:checked").val() != "H") {
                        $(".tambah").attr("disabled", "disabled");
                        $(".padam").attr("disabled", "disabled");
                        $("#tableBulan").html("");
                        $(".tambah2").removeClass("tambah2").addClass("tambah");
                    }
                    else {
                        $(".tambah").removeAttr("disabled");
                        //$(".padam").removeAttr("disabled");
                    }

                    if ($("#HR_KEW8_IND:checked").val() == "A") {
                        $("#HR_BIL2").removeAttr("disabled");
                        //$("#ansuran").removeAttr("disabled");
                        $("input[name='hari']").attr("disabled", "disabled");
                        $("select[name='bulan']").attr("disabled", "disabled");
                        $(".tambah").attr("disabled", "disabled");
                        $(".padam").attr("disabled", "disabled");
                        $("#HR_BIL3").attr("disabled", "disabled");
                        //$("#HR_JUMLAH_POTONGAN_GAJI").attr("disabled", "disabled");
                        //$("#HR_JUMLAH_POTONGAN").attr("disabled", "disabled");

                        $("input[name='hari']").val("");
                        $("select[name='bulan']").val("");
                        $("#HR_BIL3").val("");






                        $("#dataAnsuran").html("");
                        $("#tableAnsuran").html("");

                        if ($("#tableAnsuran .table tr:not(:first)").length < 1) {
                            $("#HR_JUMLAH_POTONGAN_GAJI").val("");
                            $("#HR_JUMLAH_POTONGAN").val("");
                            $("#HR_BIL").val("");
                            jumPelarasan(new Array())
                        }

                        $("#HR_BIL3").removeAttr("class").attr({ "class": "form-control" })
                        $("#HR_BIL3").parents("label").removeClass("state-error");
                        $("em[for='HR_BIL3']").remove()

                    }
                    if ($("#HR_KEW8_IND:checked").val() == "H") {
                        $("#HR_JUMLAH_POTONGAN_GAJI").val("");
                        $("#HR_JUMLAH_POTONGAN").val("");
                        $("#HR_BIL").val("0");
                        $("#HR_BIL2").attr("disabled", "disabled");
                        $("#HR_BIL2").val("");
                        //$("#ansuran").attr("disabled", "disabled");
                        $("#dataAnsuran").html("");
                        $("#tableAnsuran").html("");

                        $("input[name='hari']").removeAttr("disabled");
                        $("select[name='bulan']").removeAttr("disabled");
                        //$(".tambah").removeAttr("disabled");
                        //$(".padam").removeAttr("disabled");
                        $("#HR_BIL3").removeAttr("disabled");
                        $("#HR_BIL3").val("0");
                        //$("#HR_JUMLAH_POTONGAN_GAJI").removeAttr("disabled");
                        //$("#HR_JUMLAH_POTONGAN").removeAttr("disabled");

                        //$("#tableElaun table tbody").each(function () {
                        //    $(this).find("td").removeClass("hide")
                        //    $(this).find("#emptyData").remove();
                        //})

                        if ($("#tableBulan table tr:not(:first)").length > 0) {
                            tambahHari();
                        }
                        else {
                            jumPelarasan(new Array())
                        }

                        $("#HR_BIL2").removeAttr("class").attr({ "class": "form-control" })
                        $("#HR_BIL2").parents("label").removeClass("state-error");
                        $("em[for='HR_BIL2']").remove()
                    }
                    if ($("#HR_KEW8_IND:checked").val() == "B") {
                        $("#tableElaun table tbody").each(function () {
                            $(this).find("td#pelarasan").html("");
                            //$(this).find("td").addClass("hide");
                        });

                        $("#txtTarikhMula").text("Tarikh Mula Bayar Gaji");
                        $("#txtTarikhAkhir").text("Tarikh Akhir Bayar Gaji");
                        //$("#HR_TARIKH_MULA").val("");
                        $("#HR_TARIKH_AKHIR").val("");
                        $("#tukarTajukPotonganGaji").text("Julmah Potongan Gaji");
                        $("#tukarTajukElaun").text("Maklumat Potongan Elaun");
                        jumPelarasan(new Array())
                    }
                    if ($("#HR_KEW8_IND:checked").val() == "T") {
                        $("#tableElaun table tbody").each(function () {
                            $(this).find("td#pelarasan").html("");
                            //$(this).find("td").addClass("hide");
                        });
                        $("#txtTarikhMula").text("Tarikh Mula Tunggakan Gaji");
                        $("#txtTarikhAkhir").text("Tarikh Akhir Tunggakan Gaji");
                        //$("#HR_TARIKH_MULA").val("");
                        $("#HR_TARIKH_AKHIR").val("");
                        $("#tukarTajukPotonganGaji").text("Julmah Tunggakan Gaji");
                        $("#tukarTajukElaun").text("Maklumat Tunggakan Elaun");
                        jumPelarasan(new Array())
                    }
                }
                else {
                    KodPelarasan($("#HR_KEW8_IND:checked").val());
                    $('#HR_TARIKH_MULA').datepicker("destroy");
                    $('#HR_TARIKH_AKHIR').datepicker("destroy");

                    $("#HR_JUMLAH_PERUBAHAN_ELAUN").val("");
                    $("#HR_JUMLAH_PERUBAHAN").val("");
                    //$('#HR_TARIKH_MULA').val("");
                    $('#HR_TARIKH_AKHIR').val("");
                    $('#HR_BUTIR_PERUBAHAN').val("");
                    $('#HR_NO_SURAT_KEBENARAN').val("");
                    $('#HR_CATATAN').val("");
                    $("#HR_KOD_PELARASAN").val("");
                    $("#HR_JUMLAH_PERUBAHAN").attr("readonly", "readonly");
                    $("#HR_JUMLAH_PERUBAHAN_ELAUN").attr("readonly", "readonly");
                    if ($("#HR_KEW8_IND:checked").val() != "P") {
                        $("#jumTxt").html("Tunggakan");
                        $("#HR_KOD_POTONGAN").val('@ViewBag.kodTGaji')
                    }
                    else {
                        $("#jumTxt").html("Potongan");
                        $("#HR_KOD_POTONGAN").val('@ViewBag.kodPGaji')
                    }
                }

            });
            if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                $("input[name='HR_BIL']").on("input", function () {
                    var nilaiamaun = $(this).val();
                    $("#HR_BIL").val($(this).val())
                    if ($(this).attr('id') == "HR_BIL2") {

                        var totalElaun = 0;
                        var gaji = parseFloat($(this).val());
                        if ($(this).val() == "") {
                            gaji = 0;
                        }

                        $('#HR_NILAI_PELARASAN').each(function () {

                            if ($(this).val() == "") {
                                totalElaun += 0;
                            }
                            else {
                                totalElaun += parseFloat($(this).val());
                            }
                        })
                        var bil = 0
                        if ($(this).val() != "") {
                            bil = parseFloat($(this).val());
                        }
                        var total = parseFloat(totalElaun) + gaji;
                        $("#HR_JUMLAH_POTONGAN_GAJI").val(bil.toFixed(2));
                        $('#HR_JUMLAH_POTONGAN').val(total.toFixed(2));
                        if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                            $('#HR_JUMLAH_POTONGAN').valid()
                        }
                        if ($('#tableAnsuran tr:not(:first)').length > 0) {
                            $('#tableAnsuran tr:not(:first)').each(function (i, v) {
                                var value = parseInt($('#bulanAnsuran').val());
                                var amaun = parseInt(nilaiamaun);
                                if ($('#bulanAnsuran').val() == "") {
                                    value = 0;
                                }

                                if (nilaiamaun == "") {
                                    amaun = 0;
                                }

                                var total = amaun / value;
                                $(this).find('td:last input').val(total.toFixed(2));
                            })
                        }
                    }
                });

                $(document).on("click", "#ansuran", function () {
                    if ($("#HR_KEW8_IND:checked").val() == "A" || $("#HR_KEW8_IND:checked").val() == "H") {
                        var html = '<section>' +
                                        '<div class="row">' +
                                            '<label class="label col col-4">Bil. Bulan</label>' +
                                            '<div class="col col-3">' +
                                                '<label class="input">' +
                                                    '<input name="bulanAnsuran" type="number" class="form-control" value="" id="bulanAnsuran" />' +
                                                '</label>' +
                                            '</div>' +
                                        '</div>' +
                                   '</section>' +
                                   '<div id="tableAnsuran">' +

                                   '</div>';

                        $("#dataAnsuran").html(html)
                    }
                }).on("input click", "#bulanAnsuran", function () {
                    PadamAnsuranBulanan();

                    var bilBulan = parseInt($(this).val());

                    if ($(this).val() == "") {
                        bilBulan = 0;
                    }

                    var amaun = 0;

                    if (($("#HR_KEW8_IND:checked").val() == "A" || $("#HR_KEW8_IND:checked").val() == "H") && $("#HR_JUMLAH_POTONGAN_GAJI").val() != "")
                    {
                        amaun = parseFloat($("#HR_JUMLAH_POTONGAN_GAJI").val());
                    }

                    if (bilBulan > 1) {
                        $("#tableAnsuran").html(AnsuranBulanan(bilBulan, amaun, 0, null, "G"));
                        AnsuranElaunBulanan(bilBulan, null);
                        TarikhAnsuran();
                    }

                    if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                        $('#HR_JUMLAH_POTONGAN').valid()
                    }

                })
                //    .on("click", "#linkAnsuran", function () {
                //    if ($(this).parents("tr").next().attr("id") == "AnsuranRow") {
                //        var nextRow = $(this).parents("tr").next().slideToggle();
                //    }

                //});
                function TarikhAnsuran()
                {
                    $("#tableAnsuran .HR_TARIKH_MULA_ANSURAN").attr({ "id": "" }).removeClass('HR_TARIKH_MULA_ANSURAN').removeClass('hasDatepicker').removeData('datepicker').unbind()
                        .datepicker({
                            changeMonth: true,
                            changeYear: true,
                            dateFormat: 'dd/mm/yy',
                            prevText: '<i class="fa fa-chevron-left"></i>',
                            nextText: '<i class="fa fa-chevron-right"></i>',
                            showButtonPanel: true,
                            currentText: "Bulan Kini",
                            closeText: 'Tutup',
                            onSelect: function (selectedDate) {
                                //$('#HR_TARIKH_AKHIR_ANSURAN').datepicker('option', 'minDate', selectedDate);
                            },
                            onChangeMonthYear: function (year, month, inst) {
                                $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month - 1, 1)));

                                var name = $(this).attr("name").split(".");
                                var noindex = name[0].replace("][", ",");
                                var noindex1 = noindex.replace("[", "").replace("]", "").split(",");
                                var no = parseInt(noindex1[1]);
                                var ini = $(this);
                                var noTable = 1;
                                $("#tableElaun tbody tr td .table").each(function () {
                                    $(this).find("td input[name='[" + noTable + "][" + no + "].HR_TARIKH_MULA']").val(ini.val());
                                    noTable++;
                                });

                            },
                            onClose: function (dateText, inst) {
                                $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(inst.selectedYear, inst.selectedMonth, 1)));
                            }
                        }).focus(function () {
                            $(".ui-datepicker-calendar").hide();
                        });

                    $("#tableAnsuran .HR_TARIKH_AKHIR_ANSURAN").attr({ "id": "" }).removeClass('HR_TARIKH_AKHIR_ANSURAN').removeClass('hasDatepicker').removeData('datepicker').unbind()
                    .datepicker({
                        changeMonth: true,
                        changeYear: true,
                        dateFormat: 'dd/mm/yy',
                        prevText: '<i class="fa fa-chevron-left"></i>',
                        nextText: '<i class="fa fa-chevron-right"></i>',
                        showButtonPanel: true,
                        currentText: "Bulan Kini",
                        closeText: 'Tutup',
                        onSelect: function (selectedDate) {
                            //$('#HR_TARIKH_MULA_ANSURAN').datepicker('option', 'maxDate', selectedDate);
                        },

                        onChangeMonthYear: function (year, month, inst) {
                            $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month, 0)));

                            var name = $(this).attr("name").split(".");
                            var noindex = name[0].replace("][", ",");
                            var noindex1 = noindex.replace("[", "").replace("]", "").split(",");
                            var no = parseInt(noindex1[1]);
                            var ini = $(this);
                            var noTable = 1;
                            $("#tableElaun tbody tr td .table").each(function () {
                                $(this).find("td input[name='[" + noTable + "][" + no + "].HR_TARIKH_AKHIR']").val(ini.val());
                                noTable++;
                            });
                        },
                        onClose: function (dateText, inst) {
                            $(this).val($.datepicker.formatDate('dd/mm/yy', new Date(inst.selectedYear, inst.selectedMonth + 1, 0)));
                        }
                    }).focus(function () {
                        $(".ui-datepicker-calendar").hide();
                    });
                }
                
            }
        }

        $(document).on('click', '.tambah', function (e) {
            if ($("select[name='bulan']").val() == "" || $("input[name='hari']").val() == "" || $("#HR_KEW8_IND:checked").val() != "H") {
                e.preventDefault();
            }
            else {
                $(".tambah").removeClass("tambah").addClass("tambah2");
                $.ajax({
                    url: "../Kewangan8/CariGajiBulanan",
                    type: "GET",
                    data: { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "BULAN": $("select[name='bulan']").val() },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (gajiPokok) {
                        //var datalist = new Array();
                        var bulan = parseInt($("select[name='bulan']").val());
                        var hari = parseInt($("input[name='hari']").val());
                        //var data = new Array()
                        //data.push(bulan, hari);
                        //datalist.push(data);
                        var datalist = new Array();
                        var data = new Array();

                        var noHari = 0;
                        $("#tableBulan table tr:not(:first)").each(function () {
                            if ($(this).find("td#tBulan").html() == $("select[name='bulan']").val()) {
                                noHari++;
                                var tHari = parseInt($(this).find("td#tHari").html());
                                var totalDay = tHari + hari;
                                $(this).find("td#tHari").html(totalDay);

                                data.push(gajiPokok, bulan, totalDay)
                                datalist.push(data);

                                $(this).find("td#tPotongan").html(kiraan(datalist).toFixed(2));
                            }
                        })

                        if (noHari <= 0) {
                            data.push(gajiPokok, bulan, hari)
                            datalist.push(data);
                            $("#tableBulan").html('<table class="table table-striped table-bordered table-hover" width="100%">' +
                                                '<tr>' +
                                                    '<th>Bulan</th>' +
                                                    '<th>Hari</th>' +
                                                    '<th>Gaji</th>' +
                                                    '<th>Potongan</th>' +
                                                '</tr>' +
                                                '<tr>' +
                                                    '<td id="tBulan">' + $("select[name='bulan']").val() + '</td>' +
                                                    '<td id="tHari">' + $("input[name='hari']").val() + '</td>' +
                                                    '<td id="tGaji">' + gajiPokok + '</td>' +
                                                    '<td id="tPotongan">' + kiraan(datalist).toFixed(2) + '</td>' +
                                                '</tr>' +
                                              '</table>');


                        }
                        tambahHari();
                        $(".padam").removeAttr("disabled");
                    }
                });

            }

        }).on('click', '.tambah2', function (e) {
            $.ajax({
                url: "../Kewangan8/CariGajiBulanan",
                type: "GET",
                data: { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "BULAN": $("select[name='bulan']").val() },
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (gajiPokok) {
                    var bulan = parseInt($("select[name='bulan']").val());
                    var hari = parseInt($("input[name='hari']").val());

                    var datalist = new Array();
                    var data = new Array();

                    var noHari = 0;
                    $("#tableBulan table tr:not(:first)").each(function () {
                        if ($(this).find("td#tBulan").html() == $("select[name='bulan']").val()) {
                            noHari++;
                            var tHari = parseInt($(this).find("td#tHari").html());
                            var totalDay = tHari + hari;
                            $(this).find("td#tHari").html(totalDay);

                            data.push(gajiPokok, bulan, totalDay)
                            datalist.push(data);

                            $(this).find("td#tPotongan").html(kiraan(datalist).toFixed(2));
                        }
                    })

                    if (noHari <= 0) {
                        data.push(gajiPokok, bulan, hari)
                        datalist.push(data);

                        $("#tableBulan table").append('<tr>' +
                                                '<td id="tBulan">' + $("select[name='bulan']").val() + '</td>' +
                                                '<td id="tHari">' + $("input[name='hari']").val() + '</td>' +
                                                '<td id="tGaji">' + gajiPokok + '</td>' +
                                                '<td id="tPotongan">' + kiraan(datalist).toFixed(2) + '</td>' +
                                            '</tr>');
                    }
                    tambahHari();
                }
            });
        })
        $(document).on('click', '.padam', function (e) {
            if ($("#tableBulan table tr").length > 0) {
                var value = "";
                var no = 0;
                $("#tableBulan table tr:not(:first)").each(function () {
                    if ($(this).find("td:first").html() == $("select[name='bulan']").val() && $(this).find("td:last").html() == $("input[name='hari']").val()) {
                        //value = $(this).find("td:last").html();
                        $(this).remove();
                        tambahHari();
                        no++
                    }
                })
                if (no <= 0) {
                    //value = $("#tableBulan table tr:last td:last").html();
                    $("#tableBulan table tr:last").remove();
                    tambahHari();
                }

                if ($("#tableBulan table tr").length <= 1) {

                    $("#tableBulan").html("");
                    $(".tambah2").removeClass("tambah2").addClass("tambah");
                    $(".padam").attr("disabled", "disabled");
                }
            }

            e.preventDefault();
            return false;
        });

        @*if ('@ViewBag.Kod' == "00026") {
            HasilKiraan($('#HR_TARIKH_MULA').datepicker("getDate"), $('#HR_TARIKH_AKHIR').datepicker("getDate"));
        }*@

        function HasilKiraan(startDate, endDate) {
            var currentDate = new Date(startDate);
            var currentDate2 = new Date(startDate);
            //var between = [];
            var totalDay = 0;
            var datalist = new Array();
            var data = new Array();
            $("#HR_JUMLAH_POTONGAN_GAJI").val(totalDay.toFixed(2));
            $("#HR_JUMLAH_POTONGAN").val(totalDay.toFixed(2));
            if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                $('#HR_JUMLAH_POTONGAN').valid()
            }
            $("#HR_JUMLAH_PERUBAHAN").val(totalDay.toFixed(2));

            if (currentDate <= endDate) {
                while (currentDate <= endDate) {
                    //between.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                    totalDay++;
                }
                var date = new Date(endDate);
                var hari = totalDay;
                var bulan = $.datepicker.formatDate('dd', new Date(date.getFullYear(), date.getMonth() + 1, 0));
                var gaji = 0;
                if ('@ViewBag.Kod' == "00036") {
                    gaji = parseFloat($("#HR_GAJI_BARU").val()) - parseFloat('@ViewBag.HR_GAJI_LAMA');
                }
                else {
                    gaji = parseFloat('@ViewBag.HR_GAJI_LAMA');
                }

                if ('@ViewBag.Kod' == "LNTKN" || ('@ViewBag.Kod' == "00026" && $("#HR_KEW8_IND:checked").val() == "B")) {
                    hari -= 1;
                }

                data.push(gaji, bulan, hari);
                datalist.push(data);

                if ('@ViewBag.Kod' == "TP" || '@ViewBag.Kod' == "00026" || '@ViewBag.Kod' == "LNTKN") {
                    jumPotongGji(datalist);
                    jumPelarasan(datalist);
                }
                else if ('@ViewBag.Kod' == "00036") {
                    jumPotongGji(datalist);
                }
                else {
                    jumPotongGji(totalDay);
                    jumPelarasan(totalDay);
                }

            }
            if (currentDate2 > endDate) {
                while (currentDate2 > endDate) {
                    //between.push(new Date(currentDate));
                    currentDate2.setDate(currentDate2.getDate() - 1);
                    totalDay--;
                }
                var date = new Date(endDate);
                var hari = totalDay;
                var bulan = $.datepicker.formatDate('dd', new Date(date.getFullYear(), date.getMonth() + 1, 0));
                var gaji = 0;
                if ('@ViewBag.Kod' == "00036") {
                    gaji = parseFloat($("#HR_GAJI_BARU").val()) - parseFloat('@ViewBag.HR_GAJI_LAMA');
                }
                else {
                    gaji = parseFloat('@ViewBag.HR_GAJI_LAMA');
                }
                data.push(gaji, bulan, hari);
                datalist.push(data);

                if ('@ViewBag.Kod' == "00026" || '@ViewBag.Kod' == "LNTKN") {
                    jumPotongGji(datalist);
                    jumPelarasan(datalist);
                }
                else {
                    jumPotongGji(totalDay);
                    jumPelarasan(totalDay);
                }
            }
        }

        function tambahHari() {
            var jumHari = 0;
            var datalist = new Array();
            $("#tableBulan table tr:not(:first)").each(function () {

                var hari = parseInt($(this).find("td#tHari").html());
                var bulan = parseInt($(this).find("td#tBulan").html());
                var gaji = parseFloat($(this).find("td#tGaji").html());
                jumHari += hari;
                var data = new Array()
                data.push(gaji, bulan, hari);
                datalist.push(data);

            })
            $("#HR_BIL3").val(jumHari);
            $("#HR_BIL").val(jumHari);
            jumPotongGji(datalist);
            jumPelarasan(datalist)
        }

        function tolakHari(value) {
            var jumHari = parseInt($("#HR_BIL3").val()) - parseInt(value)
            $("#HR_BIL3").val(jumHari);
            $("#HR_BIL").val(jumHari);
        }

        function jumPotongGji(datalist) {
            var nilai2 = 0;

            nilai2 = kiraan(datalist);

            nilai2 = Math.abs(nilai2);

            if ('@ViewBag.Kod' == "00036") {
                $("#HR_JUMLAH_PERUBAHAN").val(nilai2.toFixed(2));
            }
            else {
                $("#HR_JUMLAH_POTONGAN_GAJI").val(nilai2.toFixed(2));
            }
            return nilai2;
        }

        function kiraan(datalist) {
            var jumPotongan = 0;
            $.each(datalist, function (i, v) {
                var currentDate = new Date(new Date().getFullYear(), v[1], 0);
                var bilhari = $.datepicker.formatDate('dd', new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0));
                jumPotongan += (v[0] / parseInt(bilhari) * v[2]);
            })

            return jumPotongan;
        }

        function jumPelarasan(datalist) {

            var readonly = "";
            if ($("#HR_KEW8_IND:checked").val() != "A") {
                readonly = "readonly='readonly'"
            }

            var table3 = '<table class="table table-striped table-bordered table-hover" id="tableElaun2" style="width:800px">' +
                            '<thead>' +
                                '<tr>' +
                                    '<th>#</th>' +
                                    '<th>Elaun</th>' +
                                    '<th>Jumlah Elaun</th>';
            var colspan = 3;

            if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00026" || '@ViewBag.Kod' == "TP" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "LNTKN") {

                colspan = 5
                table3 +=
                                    '<th>Pelarasan</th>' +
                                    '<th>Jumlah Pelarasan</th>';
            }
            table3 +=
                                 '</tr>' +
                              '</thead>' +
                              '<tbody>' +
                                 '<tr>' +
                                    '<td colspan="' + colspan + '" style="padding:20px" align="center">Tiada Elaun Yang Aktif</td>' +
                                 '</tr>'
            '</tbody>' +
        '</table>';

            $("#tableElaun").html(table3);
            var data = { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "JENIS": null };
            if ('@ViewBag.Kod' == "00026") {
                data = { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "JENIS": $("#HR_KEW8_IND:checked").val() }
            }

            if ('@ViewBag.Kod' == "LNTKN") {
                data = { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "JENIS": $("#HR_LANTIKAN_IND:checked").val() }
            }

            $.ajax({
                url: "../Kewangan8/JumlahPelarasan",
                type: "GET",
                data: data,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (elaun) {
                    var jumPotongan2 = 0; var jumPotongan3 = 0;
                    if (elaun.length > 0) {
                        $("#tableElaun table tbody").html("");
                    }

                    $("#tableElaun table tfoot").remove();
                    var no2 = 0

                    $.each(elaun, function (key, val) {
                        var nilaiPelarasan = 0;

                        var datalist2 = new Array();
                        $.each(datalist, function (i, v) {
                            var data = new Array()
                            data.push(val.ELAUN.HR_NILAI, v[1], v[2]);
                            datalist2.push(data);
                        })

                        nilaiPelarasan = kiraan(datalist2);

                        ++no2;
                        $("#tableElaun table tbody").append('<tr>' +
                                        '<td align="center">' + no2 + '</td>' +
                                        '<td>' + val.ELAUN.HR_KOD_ELAUN + ' :: ' + val.ELAUN.HR_PENERANGAN_ELAUN + '</td>' +
                                        '<td>' + val.ELAUN.HR_NILAI + '</td>' +
                                        '<td>' + val.KOD_PELARASAN + ' :: ' + val.PENERANGAN + '<input name="[' + no2 + '].HR_KOD_CARUMAN" type="hidden" value="' + val.ELAUN.HR_KOD_ELAUN + '" id="HR_KOD_ELAUN" /><input name="[' + no2 + '].HR_KOD_POTONGAN" type="hidden" value="' + val.KOD_PELARASAN + '" /></td>' +
                                        '<td id="pelarasan"><label class="input"><input name="[' + no2 + '].HR_NILAI" type="text" class="form-control" value="' + (+Math.abs(nilaiPelarasan)).toFixed(2) + '" id="HR_NILAI_PELARASAN" ' + readonly + ' /></label></td>' +
                                    '</tr>');
                        jumPotongan2 += parseFloat(nilaiPelarasan.toFixed(2));
                    })
                    if (elaun.length > 0 && ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00026" || '@ViewBag.Kod' == "TP" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "LNTKN")) {
                        $("#tableElaun table").append('<tfoot><tr>' +
                                        '<td colspan="4" align="right"><strong>Jumlah (RM)</strong></td>' +
                                        '<td><label class="input"><input name="TotalPelarasan" type="text" class="form-control" value="' + Math.abs(jumPotongan2).toFixed(2) + '" readonly = "readonly" id="TotalPelarasan" /></label></td>' +
                                    '</tr></tfoot>');
                    }
                    jumPotongan3 = jumPotongan2 + parseFloat(jumPotongGji(datalist));
                    $("#HR_JUMLAH_POTONGAN").val(jumPotongan3.toFixed(2));

                    if ('@ViewBag.Kod' == "00026") {
                        if ($("#HR_KEW8_IND:checked").val() == "B") {
                            $("#HR_KOD_POTONGAN").val('@ViewBag.kodPGaji');
                        }
                        else {
                            $("#HR_KOD_POTONGAN").val('@ViewBag.kodTGaji');
                        }
                    }

                    if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                        $('#HR_JUMLAH_POTONGAN').valid()
                    }

                    $('#tableElaun2').on("input", '#HR_NILAI_PELARASAN', function () {
                        var pelarasan = 0;
                        var bilBulan = 0;

                        if ($(this).val() != "") {
                            pelarasan = parseFloat($(this).val());
                        }

                        if ($("#bulanAnsuran").val() != "") {
                            var bilBulan = parseInt($("#bulanAnsuran").val());
                        }

                        var totalElaun = 0;
                        var gaji = parseFloat($('#HR_JUMLAH_POTONGAN_GAJI').val());
                        if ($('#HR_JUMLAH_POTONGAN_GAJI').val() == "") {
                            gaji = 0;
                        }
                        $('#tableElaun2 tbody tr').each(function () {
                            if ($(this).find("td input#HR_NILAI_PELARASAN").val() == "" || isNaN($(this).find("td input#HR_NILAI_PELARASAN").val())) {
                                totalElaun += 0;
                            }
                            else {
                                totalElaun += parseFloat($(this).find("td input#HR_NILAI_PELARASAN").val());
                            }
                        });

                        if ($(this).parents("tr").next().attr("id") == "AnsuranRow") {
                            var total = pelarasan / bilBulan;
                            var nextRow = $(this).parents("tr").next();
                            nextRow.find("td .table tr").each(function () {
                                $(this).find("td input#HR_BIL_ANSURAN").val(total.toFixed(2));
                            })
                        }

                        var total = parseFloat(totalElaun) + gaji;
                        $('#HR_JUMLAH_POTONGAN').val(total.toFixed(2));
                        if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                            $('#HR_JUMLAH_POTONGAN').valid()
                        }
                        $('#TotalPelarasan').val(totalElaun.toFixed(2));
                    })

                    if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                        $("#bulanAnsuran").click()
                    }
                }
            })

        }

        function jumPelarasan2(startDate, endDate, xGaji) {

            var readonly = "";
            if ($("#HR_KEW8_IND:checked").val() != "A") {
                readonly = "readonly='readonly'"
            }

            var table3 = '<table class="table table-striped table-bordered table-hover" id="tableElaun2" style="width:800px">' +
                            '<thead>' +
                                '<tr>' +
                                    '<th>#</th>' +
                                    '<th>Elaun</th>' +
                                    '<th>Jumlah Elaun</th>';
            var colspan = 3;

            if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00026" || '@ViewBag.Kod' == "TP" || '@ViewBag.Kod' == "CUTI" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "LNTKN") {

                colspan = 5
                table3 +=
                                    '<th>Pelarasan</th>' +
                                    '<th>Jumlah Pelarasan</th>';
            }
            table3 +=
                                 '</tr>' +
                              '</thead>' +
                              '<tbody>' +
                                 '<tr>' +
                                    '<td colspan="' + colspan + '" style="padding:20px" align="center">Tiada Elaun Yang Aktif</td>' +
                                 '</tr>'
                              '</tbody>' +
                          '</table>';

            $("#tableElaun").html(table3);
            var data = { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "JENIS": null };
            if ('@ViewBag.Kod' == "00026") {
                data = { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "JENIS": $("#HR_KEW8_IND:checked").val() }
            }

            if ('@ViewBag.Kod' == "LNTKN") {
                data = { "HR_NO_PEKERJA": $("#HR_NO_PEKERJA").val(), "JENIS": $("#HR_LANTIKAN_IND:checked").val() }
            }

            $.ajax({
                url: "../Kewangan8/JumlahPelarasan",
                type: "GET",
                data: data,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (elaun) {
                    var jumPotongan2 = 0; var jumPotongan3 = 0;
                    if (elaun.length > 0) {
                        $("#tableElaun table tbody").html("");
                    }

                    $("#tableElaun table tfoot").remove();
                    var no2 = 0

                    $.each(elaun, function (key, val) {
                        var nilaiPelarasan = 0;

                        if (('@ViewBag.Kod' == "CUTI" && $('#HR_KOD_PERUBAHAN').val() == "00017")) {
                            nilaiPelarasan = ajaxKiraPelarasan(startDate, endDate, endDate, val.ELAUN.HR_NILAI / 2, $('#HR_KOD_PERUBAHAN').val(), "P");
                        }
                        else {
                            nilaiPelarasan = ajaxHasilAkhirNilai(startDate, endDate, val.ELAUN.HR_NILAI, '@ViewBag.Kod', "E");
                        }

                        ++no2;
                        $("#tableElaun table tbody").append('<tr>' +
                                        '<td align="center">' + no2 + '</td>' +
                                        '<td>' + val.ELAUN.HR_KOD_ELAUN + ' :: ' + val.ELAUN.HR_PENERANGAN_ELAUN + '</td>' +
                                        '<td>' + val.ELAUN.HR_NILAI + '</td>' +
                                        '<td>' + val.KOD_PELARASAN + ' :: ' + val.PENERANGAN + '<input name="[' + no2 + '].HR_KOD_CARUMAN" type="hidden" value="' + val.ELAUN.HR_KOD_ELAUN + '" id="HR_KOD_ELAUN" /><input name="[' + no2 + '].HR_KOD_POTONGAN" type="hidden" value="' + val.KOD_PELARASAN + '" /></td>' +
                                        '<td id="pelarasan"><label class="input"><input name="[' + no2 + '].HR_NILAI" type="text" class="form-control" value="' + (+Math.abs(nilaiPelarasan)).toFixed(2) + '" id="HR_NILAI_PELARASAN" ' + readonly + ' /></label></td>' +
                                    '</tr>');
                        jumPotongan2 += parseFloat(nilaiPelarasan.toFixed(2));
                    })
                    if (elaun.length > 0 && ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00026" || '@ViewBag.Kod' == "TP" || '@ViewBag.Kod' == "CUTI" || '@ViewBag.Kod' == "00015" || '@ViewBag.Kod' == "LNTKN")) {
                        $("#tableElaun table").append('<tfoot><tr>' +
                                        '<td colspan="4" align="right"><strong>Jumlah (RM)</strong></td>' +
                                        '<td><label class="input"><input name="TotalPelarasan" type="text" class="form-control" value="' + Math.abs(jumPotongan2).toFixed(2) + '" readonly = "readonly" id="TotalPelarasan" /></label></td>' +
                                    '</tr></tfoot>');
                    }

                    if (('@ViewBag.Kod' == "CUTI" && $('#HR_KOD_PERUBAHAN').val() == "00017")) {
                        jumPotongan3 = jumPotongan2 + parseFloat(ajaxHasilAkhirNilai(startDate, endDate, xGaji, $('#HR_KOD_PERUBAHAN').val(), "G"));

                        PadamAnsuranBulanan();
                        if (startDate != null && endDate != null) {
                            $.get("../Kewangan8/BulanCutiSeparuhGaji", { startDate: startDate, endDate: endDate }, function (data) {
                                if (data.length > 1) {
                                    $("#tableAnsuran").html(AnsuranBulanan(data.length, xGaji, 0, data, "G"));
                                    AnsuranElaunBulanan(data.length, data)
                                }
                            }, "Json")
                        }
                    }
                    else {
                        jumPotongan3 = jumPotongan2 + parseFloat(ajaxHasilAkhirNilai(startDate, endDate, xGaji, '@ViewBag.Kod', "G"));
                    }

                    $("#HR_JUMLAH_POTONGAN").val(jumPotongan3.toFixed(2));

                    if ('@ViewBag.Kod' == "00026") {
                        if ($("#HR_KEW8_IND:checked").val() == "B") {
                            $("#HR_KOD_POTONGAN").val('@ViewBag.kodPGaji');
                        }
                        else {
                            $("#HR_KOD_POTONGAN").val('@ViewBag.kodTGaji');
                        }
                    }

                    if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                        $('#HR_JUMLAH_POTONGAN').valid()
                    }

                    $('#tableElaun2').on("input", '#HR_NILAI_PELARASAN', function () {
                        var pelarasan = 0;
                        var bilBulan = 0;

                        if ($(this).val() != "") {
                            pelarasan = parseFloat($(this).val());
                        }

                        if ($("#bulanAnsuran").val() != "") {
                            var bilBulan = parseInt($("#bulanAnsuran").val());
                        }

                        var totalElaun = 0;
                        var gaji = parseFloat($('#HR_JUMLAH_POTONGAN_GAJI').val());
                        if ($('#HR_JUMLAH_POTONGAN_GAJI').val() == "") {
                            gaji = 0;
                        }
                        $('#tableElaun2 tbody tr').each(function () {
                            if ($(this).find("td input#HR_NILAI_PELARASAN").val() == "" || isNaN($(this).find("td input#HR_NILAI_PELARASAN").val())) {
                                totalElaun += 0;
                            }
                            else {
                                totalElaun += parseFloat($(this).find("td input#HR_NILAI_PELARASAN").val());
                            }
                        });

                        if ($(this).parents("tr").next().attr("id") == "AnsuranRow") {
                            var total = pelarasan / bilBulan;
                            var nextRow = $(this).parents("tr").next();
                            nextRow.find("td .table tr").each(function () {
                                $(this).find("td input#HR_BIL_ANSURAN").val(total.toFixed(2));
                            })
                        }

                        var total = parseFloat(totalElaun) + gaji;
                        $('#HR_JUMLAH_POTONGAN').val(total.toFixed(2));
                        if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                            $('#HR_JUMLAH_POTONGAN').valid()
                        }
                        $('#TotalPelarasan').val(totalElaun.toFixed(2));
                    })

                    if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                        $("#bulanAnsuran").click()
                    }
                }
            })

        }

        $("select[name='bulan'], input[name='hari']").on("input", function () {
            if ($("select[name='bulan']").val() == "" || $("input[name='hari']").val() == "" || $("#HR_KEW8_IND:checked").val() != "H") {
                $(".tambah").attr("disabled", "disabled");
                $(".padam").attr("disabled", "disabled");
            }
            else {
                $(".tambah").removeAttr("disabled");
            }
        });
        if ('@ViewBag.Kod' == "00036" || '@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
            var gred = {};
            $("#list-gred option").each(function (i, el) {
                gred[$(el).data("value")] = $(el).val();
            });

            $("#HR_GRED").on("input", function () {
                $("#HR_GAJI_MIN_BARU").val("");
                $("#HR_GAJI_MAX_BARU").val("");
                $("#HR_GAJI_BARU").val("");
                //$("#HR_PGT_BARU").val("");

                $("#HR_JUMLAH_PERUBAHAN_ELAUN").val((0).toFixed(2));
                $("#HR_JUMLAH_PERUBAHAN").val((0).toFixed(2));

                ajaxGajiMin($(this).val());
                ajaxGajiPokok($("#HR_GRED").val(), null, null)
            });
            $("#HR_GAJI_MIN_BARU").on("input", function () {
                $("#HR_GAJI_BARU").val("");
                //$("#HR_PGT_BARU").val("");

                if ('@ViewBag.Kod' != "00004") {
                    $("#HR_GAJI_MAX_BARU").val("");
                    $("#HR_JUMLAH_PERUBAHAN_ELAUN").val((0).toFixed(2));
                    $("#HR_JUMLAH_PERUBAHAN").val((0).toFixed(2));
                }

                $("#list-max").html('<option></option>');
                $("#list-gaji").html('<option></option>');

                ajaxGajiMax($(this).val(), $("#HR_GRED").val())

                //ajaxGajiMin2($(this).val(), $("#HR_GRED").val());
            });
            $("#HR_GRED, #HR_GAJI_MIN_BARU, #HR_GAJI_MAX_BARU, #HR_GAJI_BARU").on("input", function () {
                $("#HR_MATRIKS_GAJI").val("");
                if ($(this).attr("id") != "HR_GAJI_BARU") {
                    $("#HR_GAJI_BARU").val("");
                    //$("#HR_PGT_BARU").val("");
                    $("#list-gaji").html('<option></option>');

                    var MIN = null;
                    var MAX = null;

                    if ($("#HR_GAJI_MIN_BARU").val() != "") {
                        MIN = $("#HR_GAJI_MIN_BARU").val()
                    }

                    if ($("#HR_GAJI_MAX_BARU").val() != "") {
                        MAX = $("#HR_GAJI_MAX_BARU").val();
                    }

                    if ($("#HR_GRED").val() != "") {
                        ajaxGajiPokok($("#HR_GRED").val(), MIN, MAX)
                    }
                }

                @*if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                    $("#HR_GAJI_BARU").val($("#HR_GAJI_MIN_BARU").val())
                }*@

                if ($("#HR_GRED").val() != "" && $("#HR_GAJI_BARU").val() != "" && '@ViewBag.Kod' == "00036") {
                    var matriks6 = ajaxKodMatriks($("#HR_GRED").val(), $("#HR_GAJI_BARU").val())
                    $("#HR_MATRIKS_GAJI").val(matriks6)
                }

                if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                    var startDate = $('#HR_TARIKH_MULA').val();
                    var endDate = $('#HR_TARIKH_AKHIR').val();
                    var gaji = parseFloat($("#HR_GAJI_MIN_BARU").val());

                    if ($("#HR_TARIKH_MULA").val() != "" && $("#HR_TARIKH_AKHIR").val() != "" && $("#HR_GRED").val() != "" && $("#HR_GAJI_MIN_BARU").val() != "") {
                        if ($("#HR_KOD_PERUBAHAN").val() == "00032") {
                            //var data = ajaxGajiMin($("#HR_GRED").val());
                            ajaxHasilNilai(startDate, endDate, gaji, '@ViewBag.Kod')
                        }
                        else {
                            ajaxHasilNilaiMemangku(startDate, endDate, $("#HR_GAJI_LAMA").val(), gaji)
                        }
                    }
                }
            });

            ajaxGajiMin($("#HR_GRED").val());

            ajaxGajiMax($("#HR_GAJI_MIN_BARU").val(), $("#HR_GRED").val());

            if ($("#HR_GRED").val() != "" && $("#HR_GAJI_MIN_BARU").val() != "" && $("#HR_GAJI_MAX_BARU").val() != "") {
                ajaxGajiPokok($("#HR_GRED").val(), $("#HR_GAJI_MIN_BARU").val(), $("#HR_GAJI_MAX_BARU").val())
            }

            $("#HR_GAJI_BARU").on("input", function () {
                $("#HR_JUMLAH_PERUBAHAN_ELAUN").val((0).toFixed(2));
                $("#HR_JUMLAH_PERUBAHAN").val((0).toFixed(2));
                if ('@ViewBag.Kod' == "00036") {
                    if ($('#HR_TARIKH_MULA').val() != "" && $('#HR_GAJI_BARU').val() != "") {
                        //var crrDate = new Date();

                        var startDate = $('#HR_TARIKH_MULA').datepicker("getDate");
                        var endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0)
                        HasilKiraan(startDate, endDate);

                    }
                }
                if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                    var startDate = $('#HR_TARIKH_MULA').val();
                    var endDate = $('#HR_TARIKH_AKHIR').val();

                    var gaji = parseFloat($("#HR_GAJI_MIN_BARU").val());

                    if ($("#HR_KOD_PERUBAHAN").val() == "00032") {
                        if ($("#HR_TARIKH_MULA").val() != "" && $("#HR_TARIKH_AKHIR").val() != "" && $("#HR_GRED").val() != "" && $("#HR_GAJI_BARU").val() != "") {
                            ajaxHasilNilai(startDate, endDate, gaji, '@ViewBag.Kod')
                        }

                    }
                    else {
                        if ($("#HR_GRED").val() != "" && $("#HR_GAJI_BARU").val() != "") {
                            ajaxHasilNilaiMemangku(startDate, endDate, $("#HR_GAJI_LAMA").val(), gaji)
                        }

                    }
                }

            });

            $("#HR_JUMLAH_PERUBAHAN_ELAUN").on("input", function () {
                if ('@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                    var startDate = $('#HR_TARIKH_MULA').val();
                    var endDate = $('#HR_TARIKH_AKHIR').val();
                    var gaji = 0;
                    if ($("#HR_TARIKH_MULA").val() != "" && $("#HR_TARIKH_AKHIR").val() != "") {
                        if (parseFloat($(this).val()) > 0) {
                            gaji = parseFloat($(this).val());
                        }
                        ajaxHasilAkhirNilai(startDate, endDate, gaji, '@ViewBag.Kod', "E")
                    }
                }
            })

            function ajaxKodMatriks(HR_GRED, HR_GAJI_POKOK) {
                var output = null;
                $.ajax({
                    url: "../Kewangan8/KodMatriks",
                    type: "GET",
                    data: { HR_GRED: HR_GRED, HR_GAJI_POKOK: HR_GAJI_POKOK },
                    dataType: "Json",
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    success: function (data) {
                        var tahap = parseFloat(data.HR_TAHAP);
                        output = "P" + data.HR_PERINGKAT + "T" + tahap.toFixed(2);
                        $("#HR_GAJI_MAX_BARU").val(data.HR_GAJI_MAX.toFixed(2));
                        $("#HR_GAJI_MIN_BARU").val(data.HR_GAJI_MIN.toFixed(2));
                    }
                });
                return output;
            }

            function ajaxGajiMin(HR_GRED) {
                $("#list-min").html('<option></option>');
                var output = new Array();
                $.ajax({
                    url: "../Kewangan8/GajiMin",
                    type: "GET",
                    data: { "HR_GRED": HR_GRED },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    success: function (data) {
                        output = data;
                        $.each(data, function (i, v) {
                            $("#list-min").append($("<option></option>").val(v.HR_GAJI_MIN.toFixed(2)))
                            if (data.length == 1) {
                                $("#HR_GAJI_MIN_BARU").val(v.HR_GAJI_MIN.toFixed(2));
                                ajaxGajiMax(v.HR_GAJI_MIN, HR_GRED);
                            }
                        })
                    }
                });

                return output;
            }

            function ajaxGajiMin2(HR_GAJI_MIN, HR_GRED) {
                var output = 0;
                $.ajax({
                    url: "../Kewangan8/GajiMin2",
                    type: "GET",
                    data: { HR_GAJI_MIN: HR_GAJI_MIN, HR_GRED: HR_GRED },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    success: function (data) {
                        output = data;
                        $("#HR_GAJI_MAX_BARU").val(data.HR_GAJI_MAX.toFixed(2));
                        ajaxGajiMax(data.HR_GAJI_MIN, HR_GRED)
                        ajaxGajiPokok(HR_GRED, HR_GAJI_MIN, data.HR_GAJI_MAX)
                    }
                });

                return output;
            }

            function ajaxGajiMax(HR_GAJI_MIN, HR_GRED) {
                $("#list-max").html('<option></option>');
                var output = new Array();
                $.ajax({
                    url: "../Kewangan8/GajiMax",
                    type: "GET",
                    data: { HR_GAJI_MIN: HR_GAJI_MIN, HR_GRED: HR_GRED },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    success: function (data) {
                        output = data;
                        $.each(data, function (i, v) {
                            $("#list-max").append($("<option></option>").val(v.HR_GAJI_MAX.toFixed(2)))
                            if (data.length == 1) {
                                $("#HR_GAJI_MAX_BARU").val(v.HR_GAJI_MAX.toFixed(2));
                                ajaxGajiPokok(HR_GRED, HR_GAJI_MIN, v.HR_GAJI_MAX)
                            }
                        })
                    }
                });

                return output;
            }

            function ajaxGajiPokok(HR_GRED, HR_GAJI_MIN, HR_GAJI_MAX) {
                $("#list-gaji").html('<option></option>');
                var p = "GajiPokok";
                if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                    p = "GajiPokok2";
                }
                var output = new Array();
                $.ajax({
                    url: "../Kewangan8/" + p,
                    type: "GET",
                    data: { HR_GRED: HR_GRED, HR_GAJI_MIN: HR_GAJI_MIN, HR_GAJI_MAX: HR_GAJI_MAX },
                    dataType: "Json",
                    async: false,
                    success: function (data) {
                        output = data;
                        if (p == "GajiPokok") {
                            $.each(data, function (i, v) {
                                $("#list-gaji").append($("<option>P" + v.HR_PERINGKAT + "T" + (v.HR_TAHAP).toFixed(2) + "</option>").val(v.HR_GAJI_POKOK.toFixed(2)))
                            })
                        }
                        else {
                            var tahap = parseFloat(data.HR_TAHAP);
                            $("#HR_GAJI_BARU").val(data.HR_GAJI_POKOK);
                            $("#HR_MATRIKS_GAJI").val("P" + data.HR_PERINGKAT + "T" + tahap.toFixed(2));
                        }

                    }
                })

                return output;
            }

            function ajaxHasilNilaiMemangku(startDate, endDate, gaji_hakiki, gred_permulaan) {
                //$('#HR_JUMLAH_PERUBAHAN_ELAUN').val((0).toFixed(2));
                var nilai = 0;

                //if (parseFloat(gaji_hakiki) > parseFloat(gred_permulaan)) {
                //    nilai = Math.max(parseFloat($("#HR_PGT_LAMA").val()), parseFloat($("#HR_PGT_BARU").val()));
                //}
                //else {
                //    nilai = gred_permulaan - gaji_hakiki
                //}

                if ($('#HR_JUMLAH_PERUBAHAN_ELAUN').val().length > 0)
                {
                    nilai = parseFloat($('#HR_JUMLAH_PERUBAHAN_ELAUN').val());
                }

                $('#HR_JUMLAH_PERUBAHAN_ELAUN').val(nilai.toFixed(2));
                ajaxHasilAkhirNilai(startDate, endDate, nilai, '@ViewBag.Kod', "E");
            }
        }

        if ('@ViewBag.Kod' == "00036" || '@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004" || '@ViewBag.Kod' == "LNTKN" || '@ViewBag.Kod' == "CUTI") {

            function ajaxHasilNilai(startDate, endDate, gaji, kod) {
                $('#HR_JUMLAH_PERUBAHAN_ELAUN').val((0).toFixed(2));
                var nilai = 0;
                if (kod == "TMK" || kod == "00032") {
                    gaji = gaji * 0.25;
                }
                $('#HR_JUMLAH_PERUBAHAN_ELAUN').val(gaji.toFixed(2));
                ajaxHasilAkhirNilai(startDate, endDate, gaji, kod, "E");
            }

            function ajaxHasilAkhirNilai(startDate, endDate, gaji, kod, jenis) {
                $('#HR_JUMLAH_PERUBAHAN').val((0).toFixed(2));
                $('#HR_JUMLAH_POTONGAN_GAJI').val((0).toFixed(2));

                var nilai = 0;

                if (kod == "LNTKN") {
                    nilai = ajaxKiraPelarasan(startDate, endDate, keyInDate3, gaji.toFixed(2), kod, jenis)
                    $('#HR_JUMLAH_POTONGAN_GAJI').val(nilai.toFixed(2));
                }
                else if (kod == "00017") {
                    nilai = ajaxKiraPelarasan(startDate, endDate, endDate, gaji.toFixed(2), kod, jenis);
                    $('#HR_JUMLAH_POTONGAN_GAJI').val(nilai.toFixed(2));

                }
                else {
                    nilai = ajaxKiraPelarasan(startDate, endDate, keyInDate3, gaji.toFixed(2), kod, jenis)
                    $('#HR_JUMLAH_PERUBAHAN').val(nilai.toFixed(2));
                }

                return nilai;
            }

            function ajaxKiraPelarasan(startDate, endDate, keyInDate, gaji, kod, jenis) {
                var nilai = 0;
                $.ajax({
                    url: "../Kewangan8/KiraPelarasan",
                    type: "GET",
                    data: { startDate: startDate, endDate: endDate, keyInDate: keyInDate, gaji: gaji, kod: kod, jenis: jenis },
                    dataType: "Json",
                    async: false,
                    success: function (data) {
                        nilai = data;
                    }
                });
                return nilai;
            }
        }

        if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004" || '@ViewBag.Kod' == "CUTI") {
            $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', $('#HR_TARIKH_MULA').datepicker("getDate"));
        }

        if ('@ViewBag.Kod' != "kew8") {
            $("#HR_KOD_PERUBAHAN").on("input", function () {
                $('#HR_TARIKH_MULA').val("");
                $('#HR_TARIKH_AKHIR').val("");
                $('#HR_BUTIR_PERUBAHAN').val("");
                $('#HR_NO_SURAT_KEBENARAN').val("");
                $('#HR_CATATAN').val("");
                $('#HR_JUMLAH_POTONGAN_GAJI').val("");
                $('#HR_JUMLAH_POTONGAN').val("");
                $('#HR_TARIKH_MULA').datepicker('option', 'maxDate', null);
                $('#HR_TARIKH_AKHIR').datepicker('option', 'minDate', null);

                if ('@ViewBag.Kod' == "CUTI") {
                    jumPelarasan2(null, null, 0)
                }
                else if ('@ViewBag.Kod' == "TP" && $('#HR_TARIKH_TAMAT').val() != "") {
                    var crrDate = new Date();
                    var startDate = $('#HR_TARIKH_TAMAT').datepicker("getDate");
                    var endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0)

                    HasilKiraan(startDate, endDate);
                }
                else if ('@ViewBag.Kod' == "TMK" || '@ViewBag.Kod' == "00032" || '@ViewBag.Kod' == "00004") {
                    $('#HR_JAWATAN_BARU').val("");
                    $('#HR_GRED').val("");
                    $('#HR_GAJI_BARU').val("");
                    $('#HR_MATRIKS_GAJI').val("");
                    $('#HR_JUMLAH_PERUBAHAN_ELAUN').val("");
                    $('#HR_JUMLAH_PERUBAHAN').val("");
                    $('#HR_GAJI_MIN_BARU').val("");

                    if ($(this).val() == "00032") {
                        $("#HR_KOD_POTONGAN").val("E0068")
                    }
                    else {
                        $("#HR_KOD_POTONGAN").val("E0090")
                    }
                }
                else {
                    jumPelarasan(new Array())
                }

            })
        }

        $('#tableElaun2').on("input", '#HR_NILAI_PELARASAN', function () {
            var pelarasan = 0;
            var bilBulan = 0;

            if ($(this).val() != "") {
                pelarasan = parseFloat($(this).val());
            }

            if ($("#bulanAnsuran").val() != "") {
                var bilBulan = parseInt($("#bulanAnsuran").val());
            }

            var totalElaun = 0;
            var gaji = parseFloat($('#HR_JUMLAH_POTONGAN_GAJI').val());
            if ($('#HR_JUMLAH_POTONGAN_GAJI').val() == "") {
                gaji = 0;
            }
            $('#tableElaun2 tbody tr').each(function () {
                if ($(this).find("td input#HR_NILAI_PELARASAN").val() == "" || isNaN($(this).find("td input#HR_NILAI_PELARASAN").val())) {
                    totalElaun += 0;
                }
                else {
                    totalElaun += parseFloat($(this).find("td input#HR_NILAI_PELARASAN").val());
                }
            });

            if ($(this).parents("tr").next().attr("id") == "AnsuranRow") {
                var total = pelarasan / bilBulan;
                var nextRow = $(this).parents("tr").next();
                nextRow.find("td .table tr").each(function () {
                    $(this).find("td input#HR_BIL_ANSURAN").val(total.toFixed(2));
                })
            }

            var total = parseFloat(totalElaun) + gaji;
            $('#HR_JUMLAH_POTONGAN').val(total.toFixed(2));
            if ('@ViewBag.Kod' == "00030" || '@ViewBag.Kod' == "00015") {
                $('#HR_JUMLAH_POTONGAN').valid()
            }
            $('#TotalPelarasan').val(totalElaun.toFixed(2));
        })

    });
</script>
<script type="text/javascript" src="~/Scripts/TextToUpperCase.js"></script>
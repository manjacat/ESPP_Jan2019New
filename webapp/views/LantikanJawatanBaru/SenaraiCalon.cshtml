@model IEnumerable<eSPP.Models.HR_MAKLUMAT_CALON_TEMUDUGA>
@{
    List<HR_MAKLUMAT_PEKERJAAN> Pekerjaan = ViewBag.Pekerjaan;
    List<HR_PENILAIAN_PRESTASI> Prestasi = ViewBag.Prestasi;
    DateTime tarikh = ViewBag.HR_TARIKH_TEMUDUGA;
    List<SelectListItem> pengesahan = ViewBag.pengesahan;
}
<div id="content">

    <div class="row">
        <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
            <h1 class="page-title txt-color-blueDark">
                <i class="fa-fw fa fa-pencil-square-o"></i>
                Senarai Calon
                <span>
                </span>
            </h1>
        </div>
    </div>

    <section id="widget-grid" class="">

        <!-- row -->
        <div class="row">

            <!-- NEW WIDGET START -->
            <!-- WIDGET END -->

        </div>

        <!-- end row -->
        <!-- row -->
        <div class="row">

            <!-- NEW WIDGET START -->
            <article class="col-sm-12">
                
                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
                    <!-- widget options:
                    usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                    data-widget-colorbutton="false"
                    data-widget-editbutton="false"
                    data-widget-togglebutton="false"
                    data-widget-deletebutton="false"
                    data-widget-fullscreenbutton="false"
                    data-widget-custombutton="false"
                    data-widget-collapsed="true"
                    data-widget-sortable="false"

                    -->
                    <header>
                        <span class="widget-icon"> <i class="fa fa-align-justify"></i> </span>
                        <h2>Senarai Calon Dalam</h2>

                    </header>

                    <!-- widget div-->
                    <div>

                        <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->

                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body">

                            <fieldset>
                                <div class="">
                                    <table id="datatable_dalam" class="table table-striped table-bordered table-hover" width="100%">
                                        <thead>
                                            <tr>
                                                <th rowspan="2" class="smart-form">
                                                    <label class="checkbox">
                                                        <input type="checkbox" name="PilihPekerja" value="1" id="PilihPekerja" class="PilihPekerja">
                                                        <i></i>
                                                    </label>
                                                </th>
                                                <th rowspan="2">#</th>
                                                <th rowspan="2" data-class="expand">No. KP (Baru)</th>
                                                <th rowspan="2" data-hide="phone">Nama</th>
                                                <th colspan="3">Laporan Prestasi</th>
                                                <th width="90" rowspan="2">JUMLAH MARKAH PRESTASI (3 tahun) (Calon Dalam Shj)</th>
                                                <th width="50" rowspan="2">Status</th>
                                                <th width="50" rowspan="2">Pilih</th>
                                            </tr>
                                            <tr>
                                                @{
                                                    int peratus2 = 20;
                                                    int tolak2 = peratus2;
                                                    for (var i = (tarikh.Year - 2); i <= tarikh.Year; i++)
                                                    {
                                                        <th>
                                                            @i (@(peratus2)%)
                                                        </th>
                                                        tolak2 -= 5;
                                                        peratus2 += tolak2;
                                                    }
                                                }
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{ var no = 0;}
                                            @foreach (var item in Model.Where(s => s.HR_PEKERJA_IND == "D").Join(Pekerjaan, HR_MAKLUMAT_CALON_TEMUDUGA => HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_PEKERJA, HR_MAKLUMAT_PEKERJAAN => HR_MAKLUMAT_PEKERJAAN.HR_NO_PEKERJA, (HR_MAKLUMAT_CALON_TEMUDUGA, HR_MAKLUMAT_PEKERJAAN) => new { HR_MAKLUMAT_CALON_TEMUDUGA, HR_MAKLUMAT_PEKERJAAN }).OrderBy(s => s.HR_MAKLUMAT_PEKERJAAN.HR_TARIKH_MASUK))
                                            {
                                                List<HR_PENILAIAN_PRESTASI> prestasi = Prestasi.Where(s => s.HR_NO_PEKERJA == item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_PEKERJA).ToList();
                                                if (prestasi == null)
                                                {
                                                    prestasi = new List<HR_PENILAIAN_PRESTASI>();
                                                    prestasi.Add(new HR_PENILAIAN_PRESTASI());
                                                }
                                                ++no;
                                                <tr>
                                                    <td align="center" class="smart-form">@Html.DisplayFor(modelItem => item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_KPBARU),@Html.DisplayFor(modelItem => item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_STATUS_TEMUDUGA)</td>
                                                    <td align="center">@no</td>
                                                    <td>
                                                        <a class="Info" id="Info" href="javascript:void(0)" data-id="@string.Format("{0:dd/MM/yyyy}", item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_TARIKH_TEMUDUGA)" data-kod="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_KOD_JAWATAN" data-taraf="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_TARAF_JAWATAN" data-kp="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_KPBARU" data-ind="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_PEKERJA_IND" title="Kemaskini">@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_KPBARU</a>
                                                    </td>
                                                    <td>@Html.DisplayFor(modelItem => item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NAMA_CALON)</td>
                                                    @{
                                                        Double peratus = 20;
                                                        Double tolak = peratus;
                                                        Double markah = 0;
                                                        for (var i = (tarikh.Year - 2); i <= tarikh.Year; i++)
                                                        {
                                                            <td>
                                                                @{
                                                                    string nilai = "-";
                                                                    HR_PENILAIAN_PRESTASI prestasi2 = prestasi.AsEnumerable().FirstOrDefault(s => s.HR_TAHUN_PRESTASI == i);
                                                                    if (prestasi2 != null)
                                                                    {
                                                                        Double jumlah = Convert.ToDouble(prestasi2.HR_JUMLAH_BESAR);
                                                                        Double dd = (peratus / 100);
                                                                        jumlah = Math.Round(jumlah * (peratus / 100), 0, MidpointRounding.ToEven);
                                                                        markah += jumlah;
                                                                        nilai = jumlah.ToString();
                                                                    }
                                                                }
                                                                @nilai
                                                            </td>
                                                                        tolak -= 5;
                                                                        peratus += tolak;
                                                                    }
                                                    }
                                                    <td align="right">@(Math.Round(markah * 30 / 100, 0, MidpointRounding.ToEven)) / 30</td>
                                                    <td>
                                                        @{
                                                            string select = null;
                                                            var color = "label-danger";
                                                            SelectListItem selectItem = pengesahan.FirstOrDefault(s => s.Value == item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_STATUS_TEMUDUGA);
                                                            if (selectItem != null)
                                                            {
                                                                select = selectItem.Text;
                                                                if (item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_STATUS_TEMUDUGA == "Y")
                                                                {
                                                                    color = "label-success";
                                                                }
                                                                else if (item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_STATUS_TEMUDUGA == "P")
                                                                {
                                                                    color = "label-warning";
                                                                }
                                                            }
                                                        }
                                                        <span class="center-block padding-5 label @color">
                                                            @select
                                                        </span>
                                                    </td>
                                                    <td>
                                                        @if (item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_STATUS_TEMUDUGA != "Y")
                                                        {
                                                            <a class="btn btn-default btn-xs Edit" id="Edit" href="javascript:void(0)" data-id="@string.Format("{0:dd/MM/yyyy}", item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_TARIKH_TEMUDUGA)" data-kod="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_KOD_JAWATAN" data-taraf="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_TARAF_JAWATAN" data-kp="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_KPBARU" data-ind="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_PEKERJA_IND" title="Kemaskini"><i class="fa fa-edit"></i></a>
                                                            <a class="btn btn-default btn-xs Padam" id="Padam" href="javascript:void(0)" data-id="@string.Format("{0:dd/MM/yyyy}", item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_TARIKH_TEMUDUGA)" data-kod="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_KOD_JAWATAN" data-taraf="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_TARAF_JAWATAN" data-kp="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_NO_KPBARU" data-ind="@item.HR_MAKLUMAT_CALON_TEMUDUGA.HR_PEKERJA_IND" title="Padam"><i class="fa fa-trash-o"></i></a>
                                                        }
                                                        else
                                                        {
                                                            <button type="button" class="btn btn-default btn-xs" id="Edit" title="Kemaskini" disabled="disabled"><i class="fa fa-edit"></i></button>
                                                            <button type="button" class="btn btn-default btn-xs" id="Padam" title="Padam" disabled="disabled"><i class="fa fa-trash-o"></i></button>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget" id="wid-id-1" data-widget-editbutton="false">
                    <!-- widget options:
                    usage: <div class="jarviswidget" id="wid-id-1" data-widget-editbutton="false">

                    data-widget-colorbutton="false"
                    data-widget-editbutton="false"
                    data-widget-togglebutton="false"
                    data-widget-deletebutton="false"
                    data-widget-fullscreenbutton="false"
                    data-widget-custombutton="false"
                    data-widget-collapsed="true"
                    data-widget-sortable="false"

                    -->
                    <header>
                        <span class="widget-icon"> <i class="fa fa-align-justify"></i> </span>
                        <h2>Senarai Calon Luar</h2>

                    </header>

                    <!-- widget div-->
                    <div>

                        <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->

                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body">

                            <fieldset>

                                <div class="">
                                    <table id="datatable_luar" class="table table-striped table-bordered table-hover" width="100%">
                                        <thead>
                                            <tr>
                                                <th class="smart-form">
                                                    <label class="checkbox">
                                                        <input type="checkbox" name="PilihPekerja2" value="1" id="PilihPekerja2" class="PilihPekerja2">
                                                        <i></i>
                                                    </label>
                                                </th>
                                                <th>#</th>
                                                <th data-class="expand">No. KP (Baru)</th>
                                                <th data-hide="phone">Nama</th>
                                                <th data-hide="phone">Kemahiran Komunikasi</th>
                                                <th data-hide="phone">Pengetahuan Am</th>
                                                <th data-hide="phone">Sifat Sahsiah</th>
                                                <th data-hide="phone">Markah Penuh</th>
                                                <th width="50">Status</th>
                                                <th width="50">Pilih</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{ var no2 = 0;}
                                            @foreach (var item in Model.Where(s => s.HR_PEKERJA_IND == "L").OrderBy(s => s.HR_NAMA_CALON))
                                            {
                                                ++no2;
                                                <tr>
                                                    <td align="center" class="smart-form">@Html.DisplayFor(modelItem => item.HR_NO_KPBARU),@Html.DisplayFor(modelItem => item.HR_STATUS_TEMUDUGA)</td>
                                                    <td align="center">@no2</td>
                                                    <td>
                                                        <a class="Info" id="Info" href="javascript:void(0)" data-id="@string.Format("{0:dd/MM/yyyy}",item.HR_TARIKH_TEMUDUGA)" data-kod="@item.HR_KOD_JAWATAN" data-taraf="@item.HR_TARAF_JAWATAN" data-kp="@item.HR_NO_KPBARU" data-ind="@item.HR_PEKERJA_IND" title="Kemaskini">@item.HR_NO_KPBARU</a>
                                                    </td>
                                                    <td>@Html.DisplayFor(modelItem => item.HR_NAMA_CALON)</td>
                                                    <td align="right">@Math.Round(Convert.ToDouble(item.HR_KEMAHIRAN_KOMUNIKASI), 0, MidpointRounding.ToEven) / 15</td>
                                                    <td align="right">@Math.Round(Convert.ToDouble(item.HR_PENGETAHUAN_AM), 0, MidpointRounding.ToEven) / 35</td>
                                                    <td align="right">@Math.Round(Convert.ToDouble(item.HR_SIFAT_SAHSIAH), 0, MidpointRounding.ToEven) / 20</td>
                                                    <td align="right">@Math.Round(Convert.ToDouble(item.HR_MARKAH_PENUH), 0, MidpointRounding.ToEven) / 100</td>
                                                    <td>
                                                        @{
                                                            string select = null;
                                                            var color = "label-danger";
                                                            SelectListItem selectItem = pengesahan.FirstOrDefault(s => s.Value == item.HR_STATUS_TEMUDUGA);
                                                            if (selectItem != null)
                                                            {
                                                                select = selectItem.Text;
                                                                if (item.HR_STATUS_TEMUDUGA == "Y")
                                                                {
                                                                    color = "label-success";
                                                                }
                                                                else if (item.HR_STATUS_TEMUDUGA == "P")
                                                                {
                                                                    color = "label-warning";
                                                                }
                                                            }
                                                        }
                                                        <span class="center-block padding-5 label @color">
                                                            @select
                                                        </span>
                                                    </td>
                                                    <td>
                                                        @if (item.HR_STATUS_TEMUDUGA != "Y")
                                                        {
                                                            <a class="btn btn-default btn-xs Edit" id="Edit" href="javascript:void(0)" data-id="@string.Format("{0:dd/MM/yyyy}",item.HR_TARIKH_TEMUDUGA)" data-kod="@item.HR_KOD_JAWATAN" data-taraf="@item.HR_TARAF_JAWATAN" data-kp="@item.HR_NO_KPBARU" data-ind="@item.HR_PEKERJA_IND" title="Kemaskini"><i class="fa fa-edit"></i></a>
                                                            <a class="btn btn-default btn-xs Padam" id="Padam" href="javascript:void(0)" data-id="@string.Format("{0:dd/MM/yyyy}",item.HR_TARIKH_TEMUDUGA)" data-kod="@item.HR_KOD_JAWATAN" data-taraf="@item.HR_TARAF_JAWATAN" data-kp="@item.HR_NO_KPBARU" data-ind="@item.HR_PEKERJA_IND" title="Padam"><i class="fa fa-trash-o"></i></a>
                                                        }
                                                        else
                                                        {
                                                            <button type="button" class="btn btn-default btn-xs" id="Edit" title="Kemaskini" disabled ="disabled"><i class="fa fa-edit"></i></button>
                                                            <button type="button" class="btn btn-default btn-xs" id="Padam" title="Padam" disabled ="disabled"><i class="fa fa-trash-o"></i></button>
                                                        }
                                                        
                                                    </td>

                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
            </article>

        </div>
        <div class="well well-sm text-right">
            @using (Html.BeginForm("CetakPDF", "LantikanJawatanBaru", FormMethod.Post, new { id = "form-print", target = "_blank" }))
            {
                @Html.Hidden("tarikh", string.Format("{0:dd/MM/yyyy}", (DateTime)ViewBag.HR_TARIKH_TEMUDUGA))
                @Html.Hidden("kod", (string)ViewBag.HR_KOD_JAWATAN)
                @Html.Hidden("taraf", (string)ViewBag.HR_TARAF_JAWATAN)
            }
            <button type="button" id="print" class="btn btn-sm btn-default"><i class="fa fa-print"></i></button>
            <button type="button" id="muktamad" class="btn btn-sm btn-success" disabled="disabled">Muktamad</button>
        </div>
    </section>

    <div class="modal fade" id="Modal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div id='ModalContent'></div>
            </div>
        </div>
    </div>
    @Html.Partial("ModalPekerja")
</div>

<!-- end row -->
<!-- ui-dialog -->
<!-- END MAIN CONTENT -->
@section pagespecific {
    <script type="text/javascript">

        // DO NOT REMOVE : GLOBAL FUNCTIONS!

        $(document).ready(function () {

            /* // DOM Position key index //

            l - Length changing (dropdown)
            f - Filtering input (search)
            t - The Table! (datatable)
            i - Information (records)
            p - Pagination (paging)
            r - pRocessing
            < and > - div elements
            <"#id" and > - div with an id
            <"class" and > - div with a class
            <"#id.class" and > - div with an id and class

            Also see: http://legacy.datatables.net/usage/features
            */

            /* BASIC ;*/
            var responsiveHelper_datatable_dalam = undefined;
            var responsiveHelper_datatable_luar = undefined;

            var breakpointDefinition = {
                tablet: 1024,
                phone: 480
            };

            /* TABLETOOLS */
            var  dalam = $('#datatable_dalam').DataTable({

                // Tabletools options:
                //   https://datatables.net/extensions/tabletools/button_options
                "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'l<'btn-adddalam'>>r>" +
                        "t" +
                        "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p><'col-sm-12 col-xs-12 text-center selected'>>",
                //"oTableTools": {
                //    "aButtons": [
                //    "copy",
                //    "csv",
                //    "xls",
                //       {
                //           "sExtends": "pdf",
                //           "sTitle": "SmartAdmin_PDF",
                //           "sPdfMessage": "SmartAdmin PDF Export",
                //           "sPdfSize": "letter"
                //       },
                //       {
                //           "sExtends": "print",
                //           "sMessage": "Generated by SmartAdmin <i>(press Esc to close)</i>"
                //       }
                //    ],
                //    "sSwfPath": "/Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
                //},
                "language": {
                    "zeroRecords": "Tiada data dijumpai",
                    "info": "Memaparkan <span class='txt-color-darken'>_START_</span> hingga <span class='txt-color-darken'>_END_</span> daripada <span class='text-primary'>_TOTAL_</span> rekod",
                    "infoEmpty": "Tiada data",
                    "infoFiltered": "(ditapis daripada <span class='text-primary'>_MAX_</span> jumlah rekod)"
                },
                "lengthMenu": [[10, 50, 100, -1], [10, 50, 100, "Semua"]],
                'columnDefs': [{
                    'targets': 0,
                    'searchable': false,
                    'orderable': false,
                    'className': 'dt-body-center',
                    'render': function (data, type, full, meta) {
                        var split = data.split(",");
                        var HR_NO_KPBARU = split[0];
                        var HR_STATUS_TEMUDUGA = "";
                        var disabled = "";
                        if (split.length >= 2) {
                            HR_STATUS_TEMUDUGA = split[1];
                        }
                        if (HR_STATUS_TEMUDUGA == "T" || HR_STATUS_TEMUDUGA == "Y") {
                            disabled = "disabled='disabled'";
                        }

                        return '<label class="checkbox"><input type="checkbox" name="HR_NO_KPBARU" value="' + $('<div/>').text(HR_NO_KPBARU).html() + '" class="HR_NO_KPBARU" ' + disabled + '><i></i></label>';
                    }
                }],
                "autoWidth": true,
                "preDrawCallback": function () {
                    // Initialize the responsive datatables helper once.
                    if (!responsiveHelper_datatable_dalam) {
                        responsiveHelper_datatable_dalam = new ResponsiveDatatablesHelper($('#datatable_dalam'), breakpointDefinition);
                    }
                },
                "rowCallback": function (nRow) {
                    responsiveHelper_datatable_dalam.createExpandIcon(nRow);
                },
                "drawCallback": function (oSettings) {
                    responsiveHelper_datatable_dalam.respond();
                }
            });

            $("div.btn-adddalam").html('<div class="text-right"><button type = "button" name = "Tambah" id = "Tambah" class = "btn btn-success" data-id="@string.Format("{0:dd/MM/yyyy}", (DateTime)ViewBag.HR_TARIKH_TEMUDUGA)" data-kod="@ViewBag.HR_KOD_JAWATAN" data-taraf="@ViewBag.HR_TARAF_JAWATAN" data-kp="@ViewBag.HR_NO_KPBARU" data-ind="D"><i class = "fa fa-plus"></i></button></div>');
            $("div.selected").html('<div style="padding-top: 9px; font-size: 13px; font-weight: 700; font-style: italic; color: #969696;">' +
                'Jumlah pekerja yang dipilih : <span class="txt-color-darken" id="jumPilih">0</span>' +
                '</div>');
            /* END TABLETOOLS */

            var luar = $('#datatable_luar').DataTable({

                // Tabletools options:
                //   https://datatables.net/extensions/tabletools/button_options
                "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'l<'btn-addluar'>>r>" +
                        "t" +
                        "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p><'col-sm-12 col-xs-12 text-center selected2'>>",
                //"oTableTools": {
                //    "aButtons": [
                //    "copy",
                //    "csv",
                //    "xls",
                //       {
                //           "sExtends": "pdf",
                //           "sTitle": "SmartAdmin_PDF",
                //           "sPdfMessage": "SmartAdmin PDF Export",
                //           "sPdfSize": "letter"
                //       },
                //       {
                //           "sExtends": "print",
                //           "sMessage": "Generated by SmartAdmin <i>(press Esc to close)</i>"
                //       }
                //    ],
                //    "sSwfPath": "/Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
                //},
                "language": {
                    "zeroRecords": "Tiada data dijumpai",
                    "info": "Memaparkan <span class='txt-color-darken'>_START_</span> hingga <span class='txt-color-darken'>_END_</span> daripada <span class='text-primary'>_TOTAL_</span> rekod",
                    "infoEmpty": "Tiada data",
                    "infoFiltered": "(ditapis daripada <span class='text-primary'>_MAX_</span> jumlah rekod)"
                },
                "lengthMenu": [[10, 50, 100, -1], [10, 50, 100, "Semua"]],
                'columnDefs': [{
                    'targets': 0,
                    'searchable': false,
                    'orderable': false,
                    'className': 'dt-body-center',
                    'render': function (data, type, full, meta) {
                        var split = data.split(",");
                        var HR_NO_KPBARU = split[0];
                        var HR_STATUS_TEMUDUGA = "";
                        var disabled = "";
                        if (split.length >= 2) {
                            HR_STATUS_TEMUDUGA = split[1];
                        }
                        if (HR_STATUS_TEMUDUGA == "T" || HR_STATUS_TEMUDUGA == "Y") {
                            disabled = "disabled='disabled'";
                        }

                        return '<label class="checkbox"><input type="checkbox" name="HR_NO_KPBARU" value="' + $('<div/>').text(HR_NO_KPBARU).html() + '" class="HR_NO_KPBARU" ' + disabled + '><i></i></label>';
                    }
                }],
                "autoWidth": true,
                "preDrawCallback": function () {
                    // Initialize the responsive datatables helper once.
                    if (!responsiveHelper_datatable_luar) {
                        responsiveHelper_datatable_luar = new ResponsiveDatatablesHelper($('#datatable_luar'), breakpointDefinition);
                    }
                },
                "rowCallback": function (nRow) {
                    responsiveHelper_datatable_luar.createExpandIcon(nRow);
                },
                "drawCallback": function (oSettings) {
                    responsiveHelper_datatable_luar.respond();
                }
            });

            $("div.btn-addluar").html('<div class="text-right"><button type = "button" name = "Tambah" id = "Tambah" class = "btn btn-success" data-id="@string.Format("{0:dd/MM/yyyy}", (DateTime)ViewBag.HR_TARIKH_TEMUDUGA)" data-kod="@ViewBag.HR_KOD_JAWATAN" data-taraf="@ViewBag.HR_TARAF_JAWATAN" data-penemuduga="@ViewBag.HR_NO_KPBARU" data-ind="L"><i class = "fa fa-plus"></i></button></div>');
            $("div.selected2").html('<div style="padding-top: 9px; font-size: 13px; font-weight: 700; font-style: italic; color: #969696;">' +
                'Jumlah pekerja yang dipilih : <span class="txt-color-darken" id="jumPilih2">0</span>' +
                '</div>');

            function jenisCheckbox(ini) {
                var table = dalam;
                if ($(ini).parents("table").attr("id") == "datatable_luar") {
                    table = luar
                }
                return table;
            }

            // Handle click on "Select all" control
            $('.PilihPekerja').on('click', function () {
                // Get all rows with search applied
                var ini = this;
                var rows = dalam.rows({ 'search': 'applied' }).nodes();
                // Check/uncheck checkboxes for all rows in the table
                $('input[type="checkbox"]:not([disabled="disabled"])', rows).prop('checked', ini.checked);
                TotalSelected(ini, dalam)
            });

            $('.PilihPekerja2').on('click', function () {
                // Get all rows with search applied
                var ini = this;
                var rows = luar.rows({ 'search': 'applied' }).nodes();
                // Check/uncheck checkboxes for all rows in the table
                $('input[type="checkbox"]:not([disabled="disabled"])', rows).prop('checked', ini.checked);
                TotalSelected(ini, luar)
            });

            $('#datatable_dalam tbody, #datatable_luar tbody').on("click", ".HR_NO_KPBARU", this, function () {
                var ini = this;
                TotalSelected(ini, jenisCheckbox(ini))
            });

            function TotalSelected(ini, table) {
                var rows = table.rows().nodes();
                var txt = "";
                if ($(ini).parents("table").attr("id") == "datatable_luar")
                {
                    txt = "2"
                }
                $("#jumPilih"+ txt).html($('input[type="checkbox"]:checked', rows).length);

                var totalSelected = $('input[type="checkbox"]:checked', rows).length;

                if (totalSelected <= 0) {
                    $("#PilihPekerja" + txt).prop("checked", false);
                }

                if ($('input[type="checkbox"]', rows).length == totalSelected) {
                    $("#PilihPekerja" + txt).prop("checked", true);
                }

                var jumlah = parseInt($("#jumPilih").html()) + parseInt($("#jumPilih2").html());
                if (jumlah <= 0) {
                    $("#muktamad").attr("disabled", "disabled")
                }
                else {
                    $("#muktamad").removeAttr("disabled")
                }

            };

            $("#muktamad").on("click", function () {
                if(confirm("Adakah anda pasti ingin muktamadkan semua calon yang dipilih?"))
                {
                    var model = [];
                    dalam.$('input[type="checkbox"]').each(function () {
                        if (this.checked) {
                            model.push({
                                HR_TARIKH_TEMUDUGA: "@ViewBag.HR_TARIKH_TEMUDUGA",
                                HR_KOD_JAWATAN: "@ViewBag.HR_KOD_JAWATAN",
                                HR_TARAF_JAWATAN: "@ViewBag.HR_TARAF_JAWATAN",
                                HR_NO_KPBARU: this.value
                            })
                        }
                    })

                    luar.$('input[type="checkbox"]').each(function () {
                        if (this.checked) {
                            model.push({
                                HR_TARIKH_TEMUDUGA: "@ViewBag.HR_TARIKH_TEMUDUGA",
                                HR_KOD_JAWATAN: "@ViewBag.HR_KOD_JAWATAN",
                                HR_TARAF_JAWATAN: "@ViewBag.HR_TARAF_JAWATAN",
                                HR_NO_KPBARU: this.value
                            })
                        }
                    })
                    $.post("../LantikanJawatanBaru/MuktamadTemuduga", { model: model }, function (data) {
                        alert(data.msg)

                        if (data.error == false) {
                            window.location.reload();
                        }
                    })
                }
                
            })

            $("#print").on("click", function () {
                $("#form-print").submit();
            })
            /* END TABLETOOLS */

            function ProcessEvent() {
                var isValid = 0;
                $("#HR_NO_KPBARU").valid();
                if ($("#HR_NO_KPBARU").valid() == false) {
                    $("#HR_NO_KPBARU").focus();
                    isValid++;
                }
                $("#HR_NAMA_CALON").valid()
                if ($("#HR_NAMA_CALON").valid() == false) {
                    $("#HR_NAMA_CALON").focus();
                    isValid++;
                }

                if (isValid <= 0) {
                    $.post("../LantikanJawatanBaru/BorangCalon", $("#form").serialize(), function (data) {
                        alert(data.msg);
                        if (!data.error) {
                            location.reload();
                        }
                    }, "json")
                }
            }

            function calon($buttonClicked) {
                var id = $buttonClicked.attr('data-id');
                var kod = $buttonClicked.attr('data-kod');
                var taraf = $buttonClicked.attr('data-taraf');
                var jenis = $buttonClicked.attr('id');
                var kp = $buttonClicked.attr('data-kp');
                var ind = $buttonClicked.attr('data-ind');

                var splitid = id.split('/');
                var day = splitid[0];
                var month = splitid[1];
                var year = splitid[2];

                var t = new Date(year, month - 1, day);
                var HR_TARIKH_TEMUDUGA = moment(t).format("MM/DD/YYYY")
                console.log(id)
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: "../LantikanJawatanBaru/BorangCalon",
                    data: { "HR_TARIKH_TEMUDUGA": id, "HR_KOD_JAWATAN": kod, "HR_TARAF_JAWATAN": taraf, "HR_NO_KPBARU": kp, "HR_PEKERJA_IND": ind, "HR_JENIS": jenis },
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    success: function (data) {
                        $('#ModalContent').html(data);
                        $('#Modal').modal(options);
                        $('#Modal').modal('show').on("click", "#btn-sub", function () {
                            if ($('#HR_JENIS').val() == "Padam") {
                                if (confirm("Adakah anda pasti ingin padam data ini?")) {
                                    ProcessEvent()
                                }
                            }
                            else {
                                ProcessEvent()
                            }
                        }).on("click", "#close, #btn-close", function () {
                            location.reload();
                        });;
                        if (jenis == "Padam") {
                            $("#btn-sub").removeClass("btn-primary").addClass("btn-danger").html('<span class="fa fa-trash-o"></span> Padam')
                            $("input:not([type='hidden']), select, textarea").attr("disabled", "disabled")
                            $("#btn-sub").show();
                        }
                        else if (jenis == "Tambah") {
                            $("#btn-sub").removeClass("btn-danger").addClass("btn-primary").html('<span class="fa fa-send-o"></span> Hantar')
                            $("input:not([type='hidden']), select, textarea").removeAttr("disabled")
                            $("#btn-sub").show();
                        }
                        else if (jenis == "Edit") {
                            $("#btn-sub").removeClass("btn-danger").addClass("btn-primary").html('<span class="fa fa-edit"></span> Kemaskini')
                            $("input:not([type='hidden']), select, textarea").removeAttr("disabled")
                            if ($("#HR_PEKERJA_IND").val() == "D") {
                                $("#HR_NAMA_CALON:not([type='hidden']").attr("disabled", "disabled")
                            }
                            else {
                                $("#HR_NO_KPBARU:not([type='hidden']").attr("disabled", "disabled")
                            }

                            $("#btn-sub").show();
                        }
                        else {
                            $("input:not([type='hidden']), select, textarea").attr("disabled", "disabled")
                            $("#btn-sub").hide();
                        }

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            }

            $("button[id='Tambah']").click(function () {
                calon($(this))
            });
            $("#datatable_dalam, #datatable_luar").on("click", "#Info, #Padam, #Edit", function () {
                calon($(this))
            });


        });
    </script>
}
